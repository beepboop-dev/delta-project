<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BriefPulse ‚Äî AI Contract Analyzer</title>
  <meta name="description" content="Understand any contract in 60 seconds. AI-powered analysis reveals red flags, risk scores, and actionable recommendations. Free ‚Äî no signup required.">
  <meta name="keywords" content="contract review, contract analyzer, free contract review, contract red flags, AI contract analysis, NDA review, lease review, freelance contract review">
  <meta property="og:title" content="BriefPulse ‚Äî AI Contract Analyzer">
  <meta property="og:description" content="Understand any contract in 60 seconds. Upload any contract for instant risk scoring, red flag detection, and negotiation suggestions. Free.">
  <meta property="og:url" content="https://delta.abapture.ai">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="BriefPulse">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="BriefPulse ‚Äî AI Contract Analyzer">
  <meta name="twitter:description" content="Understand any contract in 60 seconds. Free AI-powered contract analysis.">
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"WebApplication","name":"BriefPulse","url":"https://delta.abapture.ai","description":"AI-powered contract analyzer. Upload any contract for instant risk scoring, red flag detection, and negotiation suggestions.","applicationCategory":"BusinessApplication","offers":[{"@type":"Offer","price":"0","priceCurrency":"USD","description":"Free - 3 analyses per day"},{"@type":"Offer","price":"29","priceCurrency":"USD","description":"Pro Monthly - Unlimited analyses"},{"@type":"Offer","price":"199","priceCurrency":"USD","description":"Pro Annual - Save 43%"}]}
  </script>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìã</text></svg>">
  <style>
    :root {
      --bg: #0a0a1a; --surface: #12122a; --surface2: #1a1a3e; --surface3: #222252;
      --border: #2a2a5a; --text: #e8e8f0; --text-muted: #8888aa; --text-dim: #5a5a7a;
      --accent: #7c5cfc; --accent-glow: rgba(124,92,252,0.3);
      --red: #ef4444; --orange: #f59e0b; --green: #22c55e; --blue: #3b82f6;
      --gradient: linear-gradient(135deg, #7c5cfc, #a78bfa, #c084fc);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* Layout */
    .container { max-width: 960px; margin: 0 auto; padding: 0 1.5rem; }
    .nav { padding: 1rem 0; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); margin-bottom: 2rem; }
    .nav-brand { font-size: 1.3rem; font-weight: 800; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; cursor: pointer; }
    .nav-links { display: flex; gap: 1.2rem; align-items: center; }
    .nav-links a, .nav-links button { color: var(--text-muted); font-size: 0.9rem; background: none; border: none; cursor: pointer; font-family: inherit; }
    .nav-links a:hover, .nav-links button:hover { color: var(--text); text-decoration: none; }
    .nav-btn { padding: 0.4rem 1rem !important; border: 1px solid var(--accent) !important; border-radius: 8px !important; color: var(--accent) !important; }
    .nav-btn:hover { background: rgba(124,92,252,0.1) !important; }

    /* Hero */
    .hero { text-align: center; padding: 3rem 0 2rem; }
    .hero h1 { font-size: 2.8rem; font-weight: 800; line-height: 1.15; margin-bottom: 1rem; }
    .hero h1 span { background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .hero p { color: var(--text-muted); font-size: 1.15rem; max-width: 600px; margin: 0 auto 2rem; line-height: 1.6; }
    .hero-badges { display: flex; gap: 0.5rem; justify-content: center; flex-wrap: wrap; margin-bottom: 2rem; }
    .hero-badge { padding: 0.3rem 0.8rem; border: 1px solid var(--border); border-radius: 100px; font-size: 0.8rem; color: var(--text-muted); }
    .hero-stats { display: flex; gap: 2rem; justify-content: center; margin-top: 2rem; }
    .hero-stat { text-align: center; }
    .hero-stat-num { font-size: 1.8rem; font-weight: 800; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .hero-stat-label { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }

    /* Cards */
    .card { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 2rem; margin-bottom: 1.5rem; }
    .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
    .card h2 { font-size: 1.1rem; font-weight: 700; }
    .card h3 { font-size: 0.95rem; font-weight: 600; margin-bottom: 0.75rem; }

    /* Tabs */
    .tabs { display: flex; gap: 0; border-bottom: 2px solid var(--border); margin-bottom: 2rem; }
    .tab { padding: 0.8rem 1.5rem; font-size: 0.95rem; font-weight: 600; color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -2px; transition: all 0.2s; background: none; border-top: none; border-left: none; border-right: none; font-family: inherit; }
    .tab:hover { color: var(--text); }
    .tab.active { color: var(--accent); border-bottom-color: var(--accent); }

    /* Forms */
    textarea { width: 100%; min-height: 200px; background: var(--surface2); border: 1px solid var(--border); border-radius: 12px; padding: 1rem; color: var(--text); font-family: inherit; font-size: 0.95rem; resize: vertical; transition: border 0.2s; }
    textarea:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-glow); }
    textarea::placeholder { color: var(--text-dim); }
    input[type="text"], input[type="email"], input[type="password"] {
      width: 100%; padding: 0.75rem 1rem; background: var(--surface2); border: 1px solid var(--border);
      border-radius: 10px; color: var(--text); font-family: inherit; font-size: 0.95rem;
    }
    input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-glow); }
    label { display: block; font-weight: 600; font-size: 0.85rem; margin-bottom: 0.4rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.04em; }

    /* Buttons */
    .btn { padding: 0.8rem 1.5rem; border-radius: 10px; font-family: inherit; font-size: 0.95rem; font-weight: 600; cursor: pointer; transition: all 0.2s; border: none; }
    .btn-primary { background: var(--gradient); color: white; }
    .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 20px var(--accent-glow); }
    .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    .btn-secondary { background: var(--surface2); color: var(--text); border: 1px solid var(--border); }
    .btn-secondary:hover { border-color: var(--accent); background: rgba(124,92,252,0.1); }
    .btn-sm { padding: 0.5rem 1rem; font-size: 0.85rem; }
    .btn-full { width: 100%; }
    .btn-group { display: flex; gap: 0.75rem; flex-wrap: wrap; }

    /* Upload area */
    .upload-area { border: 2px dashed var(--border); border-radius: 12px; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.2s; margin-bottom: 1rem; }
    .upload-area:hover { border-color: var(--accent); background: rgba(124,92,252,0.05); }
    .upload-area.dragover { border-color: var(--accent); background: rgba(124,92,252,0.1); }
    .upload-icon { font-size: 2rem; margin-bottom: 0.5rem; }
    .upload-text { color: var(--text-muted); font-size: 0.9rem; }

    /* Sample contracts */
    .samples-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 0.75rem; margin-bottom: 1.5rem; }
    .sample-card { padding: 1rem; background: var(--surface2); border: 1px solid var(--border); border-radius: 12px; cursor: pointer; transition: all 0.2s; text-align: center; }
    .sample-card:hover { border-color: var(--accent); transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
    .sample-icon { font-size: 1.8rem; margin-bottom: 0.4rem; }
    .sample-name { font-weight: 600; font-size: 0.85rem; }
    .sample-desc { font-size: 0.75rem; color: var(--text-muted); margin-top: 0.2rem; }

    /* Results */
    .results { display: none; }
    .results.visible { display: block; }

    /* Risk meter */
    .risk-meter { text-align: center; padding: 1.5rem; }
    .risk-score { font-size: 4rem; font-weight: 800; line-height: 1; }
    .risk-score.high { color: var(--red); }
    .risk-score.medium { color: var(--orange); }
    .risk-score.low { color: var(--green); }
    .risk-label { font-size: 1rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; margin-top: 0.3rem; }
    .risk-bar { height: 8px; background: var(--surface2); border-radius: 4px; margin-top: 1rem; overflow: hidden; }
    .risk-bar-fill { height: 100%; border-radius: 4px; transition: width 1s ease; }
    .risk-bar-fill.high { background: var(--red); }
    .risk-bar-fill.medium { background: var(--orange); }
    .risk-bar-fill.low { background: var(--green); }

    /* Flags */
    .flag-item { padding: 1rem; margin-bottom: 0.75rem; border-left: 4px solid; border-radius: 8px; background: var(--surface2); }
    .flag-item.high { border-color: var(--red); }
    .flag-item.medium { border-color: var(--orange); }
    .flag-item.low { border-color: var(--blue); }
    .flag-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.3rem; }
    .flag-name { font-weight: 700; font-size: 0.95rem; }
    .flag-severity { font-size: 0.7rem; font-weight: 700; text-transform: uppercase; padding: 0.15rem 0.5rem; border-radius: 4px; }
    .flag-severity.high { background: rgba(239,68,68,0.2); color: var(--red); }
    .flag-severity.medium { background: rgba(245,158,11,0.2); color: var(--orange); }
    .flag-severity.low { background: rgba(59,130,246,0.2); color: var(--blue); }
    .flag-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.3rem; }
    .flag-context { font-size: 0.8rem; color: var(--text-dim); font-style: italic; background: var(--surface); padding: 0.5rem; border-radius: 6px; margin-top: 0.4rem; }

    /* Recommendations */
    .rec-item { padding: 0.8rem 1rem; margin-bottom: 0.5rem; border-radius: 8px; font-size: 0.9rem; display: flex; align-items: flex-start; gap: 0.6rem; }
    .rec-item.high { background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.2); }
    .rec-item.medium { background: rgba(245,158,11,0.1); border: 1px solid rgba(245,158,11,0.2); }
    .rec-item.low { background: rgba(34,197,94,0.1); border: 1px solid rgba(34,197,94,0.2); }
    .rec-icon { font-size: 1rem; flex-shrink: 0; margin-top: 2px; }

    /* Terms */
    .terms-grid { display: flex; flex-wrap: wrap; gap: 0.5rem; }
    .term-tag { padding: 0.4rem 0.75rem; background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; font-size: 0.85rem; }
    .term-tag .type { color: var(--accent); font-size: 0.7rem; text-transform: uppercase; display: block; }

    /* Obligations */
    .obligation { padding: 0.6rem 0; border-bottom: 1px solid var(--border); font-size: 0.88rem; }
    .obligation:last-child { border-bottom: none; }
    .obligation-strength { font-size: 0.7rem; font-weight: 600; text-transform: uppercase; padding: 0.1rem 0.4rem; border-radius: 3px; margin-right: 0.5rem; }
    .obligation-strength.mandatory { background: rgba(239,68,68,0.15); color: var(--red); }
    .obligation-strength.recommended { background: rgba(59,130,246,0.15); color: var(--blue); }

    /* Compare */
    .compare-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
    .compare-vs { text-align: center; font-size: 1.5rem; font-weight: 800; color: var(--accent); padding: 1rem; }
    @media (max-width: 768px) { .compare-grid { grid-template-columns: 1fr; } }

    /* Pricing */
    .pricing-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin: 2rem 0; }
    @media (max-width: 768px) { .pricing-grid { grid-template-columns: 1fr; } }
    .price-card { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 2rem; text-align: center; }
    .price-card.featured { border-color: var(--accent); box-shadow: 0 0 30px var(--accent-glow); position: relative; }
    .price-card.featured::before { content: 'MOST POPULAR'; position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: var(--gradient); color: white; font-size: 0.7rem; font-weight: 700; padding: 0.3rem 1rem; border-radius: 100px; }
    .price-amount { font-size: 2.5rem; font-weight: 800; margin: 1rem 0 0.3rem; }
    .price-period { color: var(--text-muted); font-size: 0.85rem; }
    .price-features { list-style: none; text-align: left; margin: 1.5rem 0; }
    .price-features li { padding: 0.4rem 0; font-size: 0.9rem; color: var(--text-muted); }
    .price-features li::before { content: '‚úì '; color: var(--green); font-weight: bold; }

    /* Testimonials */
    .testimonials { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin: 2rem 0; }
    @media (max-width: 768px) { .testimonials { grid-template-columns: 1fr; } }
    .testimonial { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem; }
    .testimonial-text { font-size: 0.9rem; font-style: italic; color: var(--text-muted); margin-bottom: 1rem; line-height: 1.5; }
    .testimonial-author { font-weight: 600; font-size: 0.85rem; }
    .testimonial-role { font-size: 0.75rem; color: var(--text-dim); }
    .stars { color: #fbbf24; margin-bottom: 0.5rem; }

    /* Competitor comparison */
    .comparison-table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; }
    .comparison-table th, .comparison-table td { padding: 0.75rem 1rem; text-align: center; border-bottom: 1px solid var(--border); font-size: 0.9rem; }
    .comparison-table th { color: var(--text-muted); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em; }
    .comparison-table td:first-child { text-align: left; font-weight: 500; }
    .comparison-table .highlight { background: rgba(124,92,252,0.1); }
    .check { color: var(--green); } .cross { color: var(--red); }

    /* Demo section */
    .demo-section { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 2rem; margin: 2rem 0; }
    .demo-output { background: var(--surface2); border-radius: 12px; padding: 1.5rem; max-height: 400px; overflow-y: auto; }

    /* Auth modal */
    .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; }
    .modal-overlay.visible { display: flex; }
    .modal { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 2rem; max-width: 420px; width: 90%; }
    .modal h2 { margin-bottom: 1.5rem; text-align: center; }
    .modal .form-group { margin-bottom: 1rem; }
    .modal .error { color: var(--red); font-size: 0.85rem; margin-top: 0.5rem; }
    .modal-footer { text-align: center; margin-top: 1rem; font-size: 0.85rem; color: var(--text-muted); }

    /* Misc */
    .divider { border: none; border-top: 1px solid var(--border); margin: 2rem 0; }
    .section-title { text-align: center; font-size: 1.8rem; font-weight: 800; margin-bottom: 0.5rem; }
    .section-sub { text-align: center; color: var(--text-muted); margin-bottom: 2rem; }
    .hidden { display: none !important; }
    .spinner { display: inline-block; width: 20px; height: 20px; border: 2px solid var(--text-muted); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.6s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .fade-in { animation: fadeIn 0.3s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .footer { text-align: center; padding: 3rem 0; color: var(--text-dim); font-size: 0.8rem; border-top: 1px solid var(--border); margin-top: 3rem; }
    .doc-type-badge { display: inline-flex; align-items: center; gap: 0.4rem; padding: 0.3rem 0.8rem; border: 1px solid var(--accent); border-radius: 100px; font-size: 0.85rem; color: var(--accent); font-weight: 500; }
    .parties-list { display: flex; gap: 0.5rem; flex-wrap: wrap; }
    .party-tag { padding: 0.3rem 0.7rem; background: rgba(124,92,252,0.15); border-radius: 6px; font-size: 0.85rem; color: var(--accent); }
    .share-bar { display: flex; gap: 0.5rem; align-items: center; margin-top: 1rem; }
    .share-bar input { flex: 1; padding: 0.5rem 0.75rem; background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 0.85rem; }

    /* Account page */
    .analysis-history { margin-top: 1rem; }
    .history-item { display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--surface2); border-radius: 10px; margin-bottom: 0.75rem; }
    .history-meta { font-size: 0.85rem; }
    .history-risk { font-weight: 700; font-size: 1.1rem; }

    /* Risk Summary Card */
    .risk-summary-card { padding: 1.5rem; border-radius: 16px; margin-bottom: 1.5rem; border: 2px solid; }
    .risk-summary-card.high { background: rgba(239,68,68,0.08); border-color: rgba(239,68,68,0.3); }
    .risk-summary-card.medium { background: rgba(245,158,11,0.08); border-color: rgba(245,158,11,0.3); }
    .risk-summary-card.low { background: rgba(34,197,94,0.08); border-color: rgba(34,197,94,0.3); }
    .risk-summary-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; }
    .risk-summary-icon { font-size: 2.5rem; }
    .risk-summary-title { font-size: 1.2rem; font-weight: 700; }
    .risk-summary-concerns { margin-top: 0.75rem; }
    .risk-summary-concern { padding: 0.3rem 0; font-size: 0.95rem; color: var(--text-muted); }
    .risk-summary-concern::before { content: '‚Ä¢ '; color: var(--text-dim); }
    .risk-overall { display: inline-block; padding: 0.25rem 0.75rem; border-radius: 100px; font-weight: 700; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.05em; }
    .risk-overall.high { background: rgba(239,68,68,0.2); color: var(--red); }
    .risk-overall.medium { background: rgba(245,158,11,0.2); color: var(--orange); }
    .risk-overall.low { background: rgba(34,197,94,0.2); color: var(--green); }

    /* Plain English */
    .plain-english { background: rgba(124,92,252,0.08); border: 1px solid rgba(124,92,252,0.2); border-radius: 8px; padding: 0.6rem 0.8rem; margin-top: 0.5rem; font-size: 0.85rem; color: var(--text); }
    .plain-english::before { content: 'üí° What this means for you: '; font-weight: 700; color: var(--accent); }

    /* Export options */
    .export-bar { display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center; }
    .export-email-form { display: flex; gap: 0.5rem; align-items: center; margin-top: 0.5rem; }
    .export-email-form input { padding: 0.5rem 0.75rem; font-size: 0.85rem; width: 220px; }

    /* Glossary */
    .glossary-search { margin-bottom: 1.5rem; }
    .glossary-search input { width: 100%; padding: 0.8rem 1rem; font-size: 1rem; }
    .glossary-item { padding: 1.25rem; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; margin-bottom: 0.75rem; }
    .glossary-term { font-size: 1.1rem; font-weight: 700; color: var(--accent); }
    .glossary-aka { font-size: 0.8rem; color: var(--text-dim); margin-top: 0.2rem; }
    .glossary-def { font-size: 0.95rem; color: var(--text-muted); margin-top: 0.5rem; line-height: 1.6; }
    .glossary-example { font-size: 0.85rem; color: var(--text-dim); margin-top: 0.5rem; font-style: italic; padding: 0.5rem 0.75rem; background: var(--surface2); border-radius: 6px; }
    .glossary-example::before { content: 'Example: '; font-weight: 600; font-style: normal; color: var(--text-muted); }
    .glossary-count { color: var(--text-dim); font-size: 0.85rem; margin-bottom: 1rem; }

    /* Bulk upload */
    .bulk-stat-card { text-align:center; background:var(--surface2); border-radius:12px; padding:1.25rem 0.75rem; }
    .bulk-stat-num { font-size:2rem; font-weight:800; }
    .bulk-stat-label { font-size:0.75rem; color:var(--text-muted); text-transform:uppercase; letter-spacing:0.05em; margin-top:0.2rem; }
    .bulk-file-item { display:flex; justify-content:space-between; align-items:center; padding:0.75rem 1rem; background:var(--surface2); border-radius:8px; margin-bottom:0.5rem; font-size:0.9rem; }
    .bulk-file-item .status { font-size:0.8rem; }
    .bulk-file-item .status.ready { color:var(--green); }
    .bulk-file-item .status.error { color:var(--red); }
    .bulk-file-item .remove-btn { background:none; border:none; color:var(--text-dim); cursor:pointer; font-size:1rem; padding:0 0.3rem; }
    .bulk-file-item .remove-btn:hover { color:var(--red); }
    .bulk-rank-item { display:flex; align-items:center; gap:1rem; padding:1rem; background:var(--surface2); border-radius:10px; margin-bottom:0.75rem; border-left:4px solid; cursor:pointer; transition:all 0.2s; }
    .bulk-rank-item:hover { transform:translateX(4px); }
    .bulk-rank-item.high { border-color:var(--red); }
    .bulk-rank-item.medium { border-color:var(--orange); }
    .bulk-rank-item.low { border-color:var(--green); }
    .bulk-rank-num { font-size:1.5rem; font-weight:800; min-width:2rem; text-align:center; color:var(--text-dim); }
    .bulk-rank-info { flex:1; }
    .bulk-rank-score { font-size:1.3rem; font-weight:800; }
    .bulk-bar-row { display:flex; align-items:center; gap:0.75rem; margin-bottom:0.75rem; }
    .bulk-bar-label { min-width:80px; font-size:0.85rem; font-weight:600; }
    .bulk-bar-track { flex:1; height:28px; background:var(--surface2); border-radius:6px; overflow:hidden; position:relative; }
    .bulk-bar-fill { height:100%; border-radius:6px; display:flex; align-items:center; justify-content:flex-end; padding:0 0.5rem; font-size:0.75rem; font-weight:700; color:white; min-width:fit-content; transition:width 0.8s ease; }
    .bulk-detail-card { background:var(--surface2); border-radius:12px; padding:1.25rem; margin-bottom:1rem; border-left:4px solid; }
    .bulk-detail-card.high { border-color:var(--red); }
    .bulk-detail-card.medium { border-color:var(--orange); }
    .bulk-detail-card.low { border-color:var(--green); }
    .bulk-detail-header { display:flex; justify-content:space-between; align-items:center; cursor:pointer; }
    .bulk-detail-body { display:none; margin-top:1rem; padding-top:1rem; border-top:1px solid var(--border); }
    .bulk-detail-body.open { display:block; }
  

    /* Negotiation Playbook */
    .neg-priority-group { margin-bottom:2rem; }
    .neg-priority-header { display:flex; align-items:center; gap:0.75rem; margin-bottom:1rem; padding-bottom:0.5rem; border-bottom:2px solid var(--border); }
    .neg-priority-badge { padding:0.3rem 0.8rem; border-radius:100px; font-size:0.75rem; font-weight:700; text-transform:uppercase; letter-spacing:0.05em; }
    .neg-priority-badge.must-negotiate { background:rgba(239,68,68,0.2); color:var(--red); }
    .neg-priority-badge.should-negotiate { background:rgba(245,158,11,0.2); color:var(--orange); }
    .neg-priority-badge.nice-to-have { background:rgba(59,130,246,0.2); color:var(--blue); }
    .neg-item { background:var(--surface2); border:1px solid var(--border); border-radius:12px; padding:1.25rem; margin-bottom:1rem; transition:all 0.2s; }
    .neg-item:hover { border-color:var(--accent); }
    .neg-item-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:0.75rem; }
    .neg-item-title { font-weight:700; font-size:1rem; }
    .neg-section { margin-bottom:0.75rem; }
    .neg-section-label { font-size:0.75rem; font-weight:700; text-transform:uppercase; letter-spacing:0.04em; color:var(--text-dim); margin-bottom:0.3rem; }
    .neg-clause-text { background:var(--surface); padding:0.6rem 0.8rem; border-radius:6px; font-size:0.85rem; color:var(--text-dim); font-style:italic; border-left:3px solid var(--red); }
    .neg-risk-text { font-size:0.9rem; color:var(--text-muted); line-height:1.5; }
    .neg-suggested { background:rgba(34,197,94,0.08); border:1px dashed rgba(34,197,94,0.3); padding:0.6rem 0.8rem; border-radius:6px; font-size:0.88rem; color:var(--green); line-height:1.5; }
    .neg-suggested::before { content:'‚úèÔ∏è '; }
    .neg-tip { background:rgba(124,92,252,0.08); border:1px solid rgba(124,92,252,0.2); border-radius:6px; padding:0.6rem 0.8rem; font-size:0.88rem; color:var(--text); line-height:1.5; }
    .neg-tip::before { content:'üí° '; }
    .neg-leverage { list-style:none; padding:0; }
    .neg-leverage li { padding:0.3rem 0; font-size:0.85rem; color:var(--text-muted); }
    .neg-leverage li::before { content:'üéØ '; }
    .neg-copy-bar { display:flex; gap:0.75rem; margin-bottom:1.5rem; flex-wrap:wrap; }
    .neg-stats { display:flex; gap:1rem; margin-bottom:1.5rem; flex-wrap:wrap; }
    .neg-stat { padding:0.6rem 1.2rem; border-radius:8px; font-weight:600; font-size:0.9rem; display:flex; align-items:center; gap:0.5rem; }
    .neg-stat.must { background:rgba(239,68,68,0.15); color:#ef4444; border:1px solid rgba(239,68,68,0.3); }
    .neg-stat.should { background:rgba(245,158,11,0.15); color:#f59e0b; border:1px solid rgba(245,158,11,0.3); }
    .neg-stat.nice { background:rgba(59,130,246,0.15); color:#3b82f6; border:1px solid rgba(59,130,246,0.3); }

    /* Clause Annotation Styles */
    .clause-stats { display:flex; gap:1rem; margin-bottom:1.5rem; flex-wrap:wrap; }
    .clause-stat { padding:0.6rem 1.2rem; border-radius:8px; font-weight:600; font-size:0.9rem; display:flex; align-items:center; gap:0.5rem; }
    .clause-stat.safe { background:rgba(16,185,129,0.15); color:#10b981; border:1px solid rgba(16,185,129,0.3); }
    .clause-stat.caution { background:rgba(245,158,11,0.15); color:#f59e0b; border:1px solid rgba(245,158,11,0.3); }
    .clause-stat.danger { background:rgba(239,68,68,0.15); color:#ef4444; border:1px solid rgba(239,68,68,0.3); }
    .clause-item { border:1px solid var(--border); border-radius:10px; margin-bottom:0.75rem; overflow:hidden; transition:all 0.2s; }
    .clause-item:hover { border-color:var(--primary); }
    .clause-item.risk-red { border-left:4px solid #ef4444; }
    .clause-item.risk-yellow { border-left:4px solid #f59e0b; }
    .clause-item.risk-green { border-left:4px solid #10b981; }
    .clause-header { padding:0.8rem 1rem; cursor:pointer; display:flex; align-items:center; gap:0.75rem; background:var(--card); }
    .clause-header:hover { background:rgba(255,255,255,0.03); }
    .clause-risk-dot { width:12px; height:12px; border-radius:50%; flex-shrink:0; }
    .clause-risk-dot.red { background:#ef4444; box-shadow:0 0 6px rgba(239,68,68,0.5); }
    .clause-risk-dot.yellow { background:#f59e0b; box-shadow:0 0 6px rgba(245,158,11,0.5); }
    .clause-risk-dot.green { background:#10b981; box-shadow:0 0 6px rgba(16,185,129,0.5); }
    .clause-title { flex:1; font-weight:500; font-size:0.95rem; }
    .clause-risk-label { font-size:0.75rem; font-weight:700; text-transform:uppercase; letter-spacing:0.5px; padding:2px 8px; border-radius:4px; }
    .clause-risk-label.red { background:rgba(239,68,68,0.2); color:#ef4444; }
    .clause-risk-label.yellow { background:rgba(245,158,11,0.2); color:#f59e0b; }
    .clause-risk-label.green { background:rgba(16,185,129,0.2); color:#10b981; }
    .clause-chevron { transition:transform 0.2s; color:var(--text-dim); }
    .clause-item.expanded .clause-chevron { transform:rotate(180deg); }
    .clause-body { display:none; padding:0 1rem 1rem; border-top:1px solid var(--border); }
    .clause-item.expanded .clause-body { display:block; }
    .clause-text { background:rgba(0,0,0,0.2); padding:0.8rem; border-radius:6px; font-size:0.85rem; line-height:1.6; color:var(--text-dim); margin:0.75rem 0; white-space:pre-wrap; max-height:200px; overflow-y:auto; }
    .clause-annotation { margin:0.5rem 0; padding:0.6rem 0.8rem; border-radius:6px; font-size:0.85rem; }
    .clause-annotation.red { background:rgba(239,68,68,0.08); border-left:3px solid #ef4444; }
    .clause-annotation.yellow { background:rgba(245,158,11,0.08); border-left:3px solid #f59e0b; }
    .clause-annotation.green { background:rgba(16,185,129,0.08); border-left:3px solid #10b981; }
    .annotation-label { font-weight:700; font-size:0.8rem; margin-bottom:0.3rem; }
    .annotation-label.red { color:#ef4444; }
    .annotation-label.yellow { color:#f59e0b; }
    .annotation-label.green { color:#10b981; }
    .annotation-detail { color:var(--text-dim); line-height:1.5; margin:0.2rem 0; }
    .annotation-detail strong { color:var(--text); }
    .annotation-alternative { background:rgba(99,102,241,0.1); border:1px dashed rgba(99,102,241,0.3); padding:0.5rem 0.7rem; border-radius:4px; margin-top:0.4rem; font-size:0.82rem; color:#818cf8; }
    .annotation-alternative::before { content:'‚úèÔ∏è '; }
    .clause-filter-bar { display:flex; gap:0.5rem; margin-bottom:1rem; flex-wrap:wrap; }
    .clause-filter-btn { padding:0.4rem 0.8rem; border-radius:6px; border:1px solid var(--border); background:transparent; color:var(--text-dim); cursor:pointer; font-size:0.8rem; transition:all 0.2s; }
    .clause-filter-btn:hover, .clause-filter-btn.active { background:var(--primary); color:white; border-color:var(--primary); }
  
  </style>
</head>
<body>
  <div class="container">
    <!-- Nav -->
    <nav class="nav">
      <div class="nav-brand" onclick="showPage('home')">üìã BriefPulse</div>
      <div class="nav-links">
        <a href="#" onclick="showPage('home'); return false;">Analyze</a>
        <a href="#" onclick="showPage('bulk'); return false;">Bulk Upload</a>
        <a href="#" onclick="showPage('compare'); return false;">Compare</a>
        <a href="#" onclick="showPage('samples'); return false;">Samples</a>
        <a href="#" onclick="showPage('glossary'); return false;">Glossary</a>
        <a href="#" onclick="showPage('templates'); return false;">Templates</a>
        <a href="#" onclick="scrollToPricing(); return false;">Pricing</a>
        <div id="auth-nav">
          <button class="nav-btn" onclick="showAuthModal('login')">Log In</button>
        </div>
      </div>
    </nav>

    <!-- HOME PAGE -->
    <div id="page-home">
      <div class="hero" id="hero-section">
        <h1>Understand any contract<br>in <span>60 seconds</span></h1>
        <p>AI-powered analysis reveals red flags, risk scores, and actionable recommendations. Stop signing contracts you don't understand.</p>
        <div class="hero-badges">
          <span class="hero-badge">üîç 30+ Red Flag Patterns</span>
          <span class="hero-badge">‚öñÔ∏è Risk Scoring</span>
          <span class="hero-badge">üìÑ PDF Export</span>
          <span class="hero-badge">üîÑ Contract Comparison</span>
        </div>
        <div class="hero-stats">
          <div class="hero-stat"><div class="hero-stat-num">30+</div><div class="hero-stat-label">Red Flag Patterns</div></div>
          <div class="hero-stat"><div class="hero-stat-num">9</div><div class="hero-stat-label">Document Types</div></div>
          <div class="hero-stat"><div class="hero-stat-num">< 3s</div><div class="hero-stat-label">Analysis Time</div></div>
        </div>
      </div>

      <!-- Input section -->
      <div class="card" id="input-section">
        <h2>üìã Paste or Upload Your Contract</h2>
        <div style="margin-top:1rem">
          <div class="upload-area" id="upload-area" onclick="document.getElementById('file-input').click()">
            <div class="upload-icon">üìé</div>
            <div class="upload-text">Drop a file here or click to upload (PDF, TXT, DOC)</div>
          </div>
          <input type="file" id="file-input" accept=".pdf,.txt,.doc,.docx" style="display:none">
          <div style="text-align:center;color:var(--text-dim);font-size:0.85rem;margin-bottom:1rem">‚Äî or paste your contract text below ‚Äî</div>
          <textarea id="contract-text" placeholder="Paste your contract, lease, NDA, employment agreement, or terms of service here..."></textarea>
        </div>
        <div style="margin-top:1rem;">
          <label>Quick Test ‚Äî Try a Sample Contract:</label>
          <div class="samples-grid" id="quick-samples"></div>
        </div>
        <button class="btn btn-primary btn-full" style="margin-top:1rem" onclick="runAnalysis()" id="analyze-btn">
          üîç Analyze Contract
        </button>
        <div style="text-align:center;margin-top:0.75rem">
          <span id="usage-counter" style="font-size:0.8rem;color:var(--text-dim)"></span>
        </div>
      </div>

      <!-- Results -->
      <div class="results" id="results-section">
        <div class="card fade-in">
          <div class="card-header">
            <div>
              <h2>Analysis Results</h2>
              <div style="margin-top:0.4rem" id="result-doctype"></div>
            </div>
            <div class="btn-group">
              <button class="btn btn-secondary btn-sm" onclick="copyToClipboard()">üìã Copy</button>
              <button class="btn btn-secondary btn-sm" onclick="exportPDF()">üìÑ PDF</button>
              <button class="btn btn-secondary btn-sm" onclick="toggleEmailExport()">‚úâÔ∏è Email</button>
              <button class="btn btn-secondary btn-sm" onclick="shareResult()">üîó Share</button>
              <button class="btn btn-secondary btn-sm" onclick="newAnalysis()">+ New</button>
            </div>
          </div>

          <!-- Risk Score -->
          <div class="risk-meter">
            <div class="risk-score" id="risk-score">0</div>
            <div class="risk-label" id="risk-label">Calculating...</div>
            <div class="risk-bar"><div class="risk-bar-fill" id="risk-bar" style="width:0%"></div></div>
          </div>

          <!-- Parties -->
          <div id="parties-section" class="hidden" style="margin-top:1.5rem">
            <h3>üë• Parties Identified</h3>
            <div class="parties-list" id="parties-list"></div>
          </div>

          <div id="email-export-section" class="hidden" style="margin-top:0.75rem">
            <div class="export-email-form">
              <input type="email" id="email-export-input" placeholder="you@example.com">
              <button class="btn btn-primary btn-sm" onclick="sendEmailReport()">Send Report</button>
            </div>
            <div id="email-status" style="font-size:0.8rem;margin-top:0.3rem;color:var(--text-dim)"></div>
          </div>

          <div id="share-section" class="hidden">
            <div class="share-bar">
              <input type="text" id="share-url" readonly>
              <button class="btn btn-secondary btn-sm" onclick="copyShareUrl()">Copy</button>
            </div>
          </div>
        </div>

        <!-- Risk Summary Card -->
        <div id="risk-summary-card" class="risk-summary-card hidden fade-in"></div>

        <!-- Result tabs -->
        <div class="tabs">
          <button class="tab active" onclick="showResultTab('flags')">üö© Red Flags</button>
          <button class="tab" onclick="showResultTab('recs')">üí° Recommendations</button>
          <button class="tab" onclick="showResultTab('terms')">üìä Key Terms</button>
          <button class="tab" onclick="showResultTab('obligations')">üìú Obligations</button>
          <button class="tab" onclick="showResultTab('negotiation')">ü§ù Negotiation Playbook</button>
          <button class="tab" onclick="showResultTab('annotated')">üìÑ Annotated View</button>
        </div>

        <div id="tab-flags" class="card fade-in">
          <div id="flags-list"></div>
        </div>
        <div id="tab-recs" class="card hidden fade-in">
          <div id="recs-list"></div>
        </div>
        <div id="tab-terms" class="card hidden fade-in">
          <h3>üí∞ Financial & Duration Terms</h3>
          <div class="terms-grid" id="terms-list" style="margin-top:0.75rem"></div>
          <div id="dates-section" style="margin-top:1.5rem">
            <h3>üìÖ Important Dates</h3>
            <div class="terms-grid" id="dates-list" style="margin-top:0.75rem"></div>
          </div>
        </div>
        <div id="tab-obligations" class="card hidden fade-in">
          <div id="obligations-list"></div>
        </div>
        <div id="tab-negotiation" class="card hidden fade-in">
          <div id="negotiation-content"></div>
        </div>
      </div>

      <!-- Live Demo -->
      <div id="demo-section" style="margin-top:3rem">
        <div class="section-title">See It In Action</div>
        <p class="section-sub">Here's what BriefPulse finds in a typical freelance agreement</p>
        <div class="demo-section" id="demo-output"></div>
      </div>

      <div id="tab-annotated" class="card hidden fade-in">
          <div id="clause-stats" class="clause-stats"></div>
          <div id="annotated-clauses"></div>
        </div>

        <!-- Testimonials -->
      <hr class="divider">
      <div class="section-title">Trusted by Professionals</div>
      <p class="section-sub">Join thousands who review contracts smarter</p>
      <div class="testimonials">
        <div class="testimonial">
          <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
          <div class="testimonial-text">"Found a non-compete clause buried on page 12 that would have prevented me from freelancing for 2 years. BriefPulse saved my career."</div>
          <div class="testimonial-author">Sarah K.</div>
          <div class="testimonial-role">Freelance Designer</div>
        </div>
        <div class="testimonial">
          <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
          <div class="testimonial-text">"I review 20+ vendor contracts a month. BriefPulse cuts my initial review time from 2 hours to 5 minutes. The red flag detection is incredibly accurate."</div>
          <div class="testimonial-author">Michael T.</div>
          <div class="testimonial-role">Startup COO</div>
        </div>
        <div class="testimonial">
          <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
          <div class="testimonial-text">"My landlord tried to sneak in a clause letting them enter without notice. BriefPulse caught it immediately. Worth every penny."</div>
          <div class="testimonial-author">Jamie L.</div>
          <div class="testimonial-role">Apartment Renter</div>
        </div>
      </div>

      <!-- Competitor comparison -->
      <hr class="divider">
      <div class="section-title">How We Compare</div>
      <p class="section-sub">BriefPulse vs alternatives</p>
      <table class="comparison-table">
        <thead><tr>
          <th></th><th class="highlight">BriefPulse</th><th>ChatGPT</th><th>Lawyer</th><th>LegalZoom</th>
        </tr></thead>
        <tbody>
          <tr><td>Structured risk analysis</td><td class="highlight check">‚úì</td><td class="cross">‚úó</td><td class="check">‚úì</td><td class="cross">‚úó</td></tr>
          <tr><td>30+ red flag patterns</td><td class="highlight check">‚úì</td><td class="cross">‚úó</td><td class="check">‚úì</td><td class="cross">‚úó</td></tr>
          <tr><td>Risk score</td><td class="highlight check">‚úì</td><td class="cross">‚úó</td><td class="cross">‚úó</td><td class="cross">‚úó</td></tr>
          <tr><td>Contract comparison</td><td class="highlight check">‚úì</td><td class="cross">‚úó</td><td class="check">‚úì</td><td class="cross">‚úó</td></tr>
          <tr><td>Under 60 seconds</td><td class="highlight check">‚úì</td><td class="check">~‚úì</td><td class="cross">‚úó</td><td class="cross">‚úó</td></tr>
          <tr><td>PDF export</td><td class="highlight check">‚úì</td><td class="cross">‚úó</td><td class="check">‚úì</td><td class="cross">‚úó</td></tr>
          <tr><td>Actionable recommendations</td><td class="highlight check">‚úì</td><td class="cross">~</td><td class="check">‚úì</td><td class="cross">‚úó</td></tr>
          <tr><td>Cost</td><td class="highlight">$29/mo</td><td>$20/mo</td><td>$300+/hr</td><td>$99+</td></tr>
        </tbody>
      </table>

      <!-- Pricing -->
      <hr class="divider" id="pricing-section">
      <div class="section-title">Simple Pricing</div>
      <p class="section-sub">Start free. Upgrade when you need more.</p>
      <div class="pricing-grid">
        <div class="price-card">
          <h3>Free</h3>
          <div class="price-amount">$0</div>
          <div class="price-period">forever</div>
          <ul class="price-features">
            <li>3 analyses per day</li>
            <li>All 30+ red flag patterns</li>
            <li>Risk scoring</li>
            <li>Sample contract library</li>
          </ul>
          <button class="btn btn-secondary btn-full" onclick="scrollToInput()">Get Started</button>
        </div>
        <div class="price-card featured">
          <h3>Pro Monthly</h3>
          <div class="price-amount">$29</div>
          <div class="price-period">/month</div>
          <ul class="price-features">
            <li>Unlimited analyses</li>
            <li>Contract comparison</li>
            <li>PDF export</li>
            <li>Save analysis history</li>
            <li>Priority support</li>
          </ul>
          <button class="btn btn-primary btn-full" onclick="checkout('monthly')">Upgrade to Pro</button>
        </div>
        <div class="price-card">
          <h3>Pro Annual</h3>
          <div class="price-amount">$199</div>
          <div class="price-period">/year ‚Äî save 43%</div>
          <ul class="price-features">
            <li>Everything in Pro</li>
            <li>2 months free</li>
            <li>Annual billing</li>
          </ul>
          <button class="btn btn-primary btn-full" onclick="checkout('annual')">Save 43%</button>
        </div>
      </div>
    </div>

    <!-- BULK UPLOAD PAGE -->
    <div id="page-bulk" class="hidden">
      <div class="section-title">üì¶ Bulk Contract Upload</div>
      <p class="section-sub">Upload multiple contracts at once. Get a summary dashboard and risk comparison across all files.</p>

      <div class="card">
        <div class="upload-area" id="bulk-upload-area" style="min-height:180px;border-width:3px">
          <div class="upload-icon" style="font-size:3rem">üìÇ</div>
          <div style="font-size:1.1rem;font-weight:600;margin-bottom:0.3rem">Drop multiple files here</div>
          <div class="upload-text">or click to select files (PDF, TXT, DOC ‚Äî up to 20 files)</div>
        </div>
        <input type="file" id="bulk-file-input" accept=".pdf,.txt,.doc,.docx" multiple style="display:none">

        <!-- File Queue -->
        <div id="bulk-queue" class="hidden" style="margin-top:1.5rem">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.75rem">
            <h3>üìã File Queue</h3>
            <span id="bulk-queue-count" style="color:var(--text-muted);font-size:0.85rem"></span>
          </div>
          <div id="bulk-queue-list"></div>
          <div style="margin-top:1rem;display:flex;gap:0.75rem">
            <button class="btn btn-primary" onclick="runBulkAnalysis()" id="bulk-analyze-btn" style="flex:1">üîç Analyze All</button>
            <button class="btn btn-secondary" onclick="clearBulkQueue()">Clear</button>
          </div>
        </div>

        <!-- Progress -->
        <div id="bulk-progress" class="hidden" style="margin-top:1.5rem">
          <div style="display:flex;justify-content:space-between;margin-bottom:0.5rem">
            <span style="font-weight:600">Analyzing contracts...</span>
            <span id="bulk-progress-text" style="color:var(--text-muted);font-size:0.85rem">0%</span>
          </div>
          <div class="risk-bar" style="height:12px;border-radius:6px">
            <div id="bulk-progress-bar" class="risk-bar-fill" style="width:0%;background:var(--gradient);transition:width 0.3s"></div>
          </div>
        </div>
      </div>

      <!-- Summary Dashboard -->
      <div id="bulk-dashboard" class="hidden" style="margin-top:1.5rem">
        <div class="card fade-in">
          <div class="card-header">
            <h2>üìä Summary Dashboard</h2>
            <button class="btn btn-secondary btn-sm" onclick="clearBulkResults()">+ New Batch</button>
          </div>

          <!-- Stats row -->
          <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-top:1rem" id="bulk-stats"></div>
        </div>

        <!-- Risk Distribution -->
        <div class="card fade-in" style="margin-top:1rem">
          <h3>üìà Risk Distribution</h3>
          <div id="bulk-risk-chart" style="margin-top:1rem"></div>
        </div>

        <!-- Common Red Flags -->
        <div class="card fade-in" style="margin-top:1rem">
          <h3>üö© Most Common Red Flags Across All Contracts</h3>
          <div id="bulk-common-flags" style="margin-top:1rem"></div>
        </div>

        <!-- Ranking / Comparison -->
        <div class="card fade-in" style="margin-top:1rem">
          <h3>üèÜ Contract Risk Ranking (Highest Risk First)</h3>
          <div id="bulk-ranking" style="margin-top:1rem"></div>
        </div>

        <!-- Individual Results -->
        <div class="card fade-in" style="margin-top:1rem">
          <h3>üìÑ Individual Contract Details</h3>
          <div id="bulk-details" style="margin-top:1rem"></div>
        </div>
      </div>
    </div>

    <!-- COMPARE PAGE -->
    <div id="page-compare" class="hidden">
      <div class="section-title">Compare Two Contracts</div>
      <p class="section-sub">See which contract is safer, side by side</p>
      <div class="compare-grid">
        <div class="card">
          <h3>Contract 1</h3>
          <textarea id="compare-text1" placeholder="Paste first contract..." style="min-height:300px"></textarea>
        </div>
        <div class="card">
          <h3>Contract 2</h3>
          <textarea id="compare-text2" placeholder="Paste second contract..." style="min-height:300px"></textarea>
        </div>
      </div>
      <button class="btn btn-primary btn-full" onclick="runComparison()" id="compare-btn" style="margin-top:1rem">üîÑ Compare Contracts</button>
      <div id="compare-results" class="hidden" style="margin-top:2rem"></div>
    </div>

    <!-- SAMPLES PAGE -->
    <div id="page-samples" class="hidden">
      <div class="section-title">Sample Contract Library</div>
      <p class="section-sub">Test BriefPulse with realistic contract templates</p>
      <div class="samples-grid" id="full-samples" style="grid-template-columns: repeat(auto-fill, minmax(250px, 1fr))"></div>
      <div id="sample-preview" class="hidden">
        <div class="card">
          <div class="card-header">
            <h2 id="sample-preview-title"></h2>
            <button class="btn btn-primary btn-sm" onclick="analyzeSamplePreview()">üîç Analyze This</button>
          </div>
          <pre id="sample-preview-text" style="white-space:pre-wrap;font-size:0.85rem;color:var(--text-muted);max-height:500px;overflow-y:auto;background:var(--surface2);padding:1rem;border-radius:8px;margin-top:1rem"></pre>
        </div>
      </div>
    </div>

    <!-- GLOSSARY PAGE -->
    <div id="page-glossary" class="hidden">
      <div class="section-title">üìñ Contract Glossary</div>
      <p class="section-sub">Common contract terms explained in plain English</p>
      <div class="glossary-search">
        <input type="text" id="glossary-search" placeholder="Search terms (e.g., indemnification, force majeure...)">
      </div>
      <div class="glossary-count" id="glossary-count"></div>
      <div id="glossary-list"></div>
    </div>

    <div id="page-templates" class="hidden">
      <h2 style="font-size:1.8rem;font-weight:800;margin-bottom:0.5rem;">üìÑ Contract Template Library</h2>
      <p style="color:var(--text-muted);margin-bottom:1.5rem;">Pre-built contract templates with placeholder fields. Preview, customize, and analyze any template instantly.</p>
      
      <div style="display:flex;gap:0.75rem;margin-bottom:1.5rem;flex-wrap:wrap;">
        <input type="text" id="template-search" placeholder="Search templates..." style="flex:1;min-width:200px;" oninput="filterTemplates()">
        <select id="template-category-filter" style="padding:0.75rem 1rem;background:var(--surface2);border:1px solid var(--border);border-radius:10px;color:var(--text);font-family:inherit;" onchange="filterTemplates()">
          <option value="">All Categories</option>
        </select>
      </div>
      
      <div id="templates-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1rem;"></div>
    </div>

    <!-- Template Preview Modal -->
    <div id="template-modal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:1000;overflow-y:auto;padding:2rem;">
      <div style="max-width:800px;margin:0 auto;background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:2rem;position:relative;">
        <button onclick="closeTemplateModal()" style="position:absolute;top:1rem;right:1rem;background:none;border:none;color:var(--text-muted);font-size:1.5rem;cursor:pointer;">&times;</button>
        <div id="template-modal-content"></div>
      </div>
    </div>


    <!-- ACCOUNT PAGE -->
    <div id="page-account" class="hidden">
      <div class="section-title">Your Account</div>
      <div class="card" id="account-info"></div>
      <div class="card">
        <h2>Analysis History</h2>
        <div class="analysis-history" id="analysis-history"></div>
      </div>
    </div>

    <div class="footer">
      <p>üìã BriefPulse ‚Äî AI Contract Analyzer</p>
      <p style="margin-top:0.3rem">This tool provides informational analysis only. It does not constitute legal advice. Always consult a qualified attorney for important contracts.</p>
      <p style="margin-top:0.5rem; color: var(--text-dim);">¬© 2026 BriefPulse. All rights reserved.</p>
    </div>
  </div>

  <!-- Auth Modal -->
  <div class="modal-overlay" id="auth-modal">
    <div class="modal">
      <h2 id="auth-modal-title">Log In</h2>
      <div id="auth-form">
        <div class="form-group" id="auth-name-group" style="display:none">
          <label>Name</label>
          <input type="text" id="auth-name" placeholder="Your name">
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="auth-email" placeholder="you@example.com">
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="auth-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>
        <div class="error" id="auth-error"></div>
        <button class="btn btn-primary btn-full" style="margin-top:1rem" onclick="submitAuth()" id="auth-submit-btn">Log In</button>
      </div>
      <div class="modal-footer">
        <span id="auth-toggle-text">Don't have an account? </span>
        <a href="#" onclick="toggleAuthMode(); return false;" id="auth-toggle-link">Sign up</a>
        <br><a href="#" onclick="closeAuthModal(); return false;" style="color:var(--text-dim)">Cancel</a>
      </div>
    </div>
  </div>

  <script>
    // ========== STATE ==========
    let currentAnalysis = null;
    let currentShareId = null;
    let authToken = localStorage.getItem('bp_token');
    let currentUser = null;
    let authMode = 'login';
    let sampleContracts = {};

    // ========== INIT ==========
    async function init() {
      // Load config
      try {
        const res = await fetch('/api/config');
        const config = await res.json();
        // Build quick sample buttons
        if (config.sampleContracts) {
          const grid = document.getElementById('quick-samples');
          const fullGrid = document.getElementById('full-samples');
          config.sampleContracts.forEach(s => {
            grid.innerHTML += `<div class="sample-card" onclick="loadSample('${s.id}')"><div class="sample-icon">${s.icon}</div><div class="sample-name">${s.name}</div></div>`;
            fullGrid.innerHTML += `<div class="sample-card" onclick="previewSample('${s.id}')"><div class="sample-icon">${s.icon}</div><div class="sample-name">${s.name}</div><div class="sample-desc">${s.description}</div></div>`;
          });
        }
      } catch(e) {}

      // Check auth
      if (authToken) {
        try {
          const res = await fetch('/api/auth/me', { headers: { Authorization: 'Bearer ' + authToken } });
          if (res.ok) {
            currentUser = await res.json();
            updateAuthUI();
          } else {
            localStorage.removeItem('bp_token');
            authToken = null;
          }
        } catch(e) {}
      }

      // Check for bulk URL
      if (location.pathname === '/bulk') { showPage('bulk'); }

      // Check for share URL
      if (location.pathname.startsWith('/share/')) {
        const id = location.pathname.split('/share/')[1];
        loadSharedResult(id);
      }

      // Run demo
      runDemo();

      // Check success/cancel
      const params = new URLSearchParams(location.search);
      if (params.get('success')) { alert('üéâ Welcome to BriefPulse Pro! You now have unlimited analyses.'); history.replaceState({}, '', '/'); }
      if (params.get('canceled')) { history.replaceState({}, '', '/'); }
    }

    // ========== NAVIGATION ==========
    function showPage(page) {
      document.querySelectorAll('[id^="page-"]').forEach(el => el.classList.add('hidden'));
      document.getElementById('page-' + page)?.classList.remove('hidden');
      if (page === 'home') {
        document.getElementById('hero-section').classList.remove('hidden');
      }
      if (page === 'account' && currentUser) loadAccount();
      if (page === 'glossary') loadGlossary();
      if (page === 'templates') loadTemplates();
      window.scrollTo(0, 0);
    }

    function scrollToPricing() {
      showPage('home');
      setTimeout(() => document.getElementById('pricing-section')?.scrollIntoView({ behavior: 'smooth' }), 100);
    }

    function scrollToInput() {
      document.getElementById('input-section')?.scrollIntoView({ behavior: 'smooth' });
    }

    // ========== ANALYSIS ==========
    async function runAnalysis() {
      const text = document.getElementById('contract-text').value.trim();
      if (text.length < 50) return alert('Please paste a contract (at least 50 characters).');

      const btn = document.getElementById('analyze-btn');
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner"></span> Analyzing...';

      try {
        const res = await fetch('/api/analyze', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', ...(authToken ? { Authorization: 'Bearer ' + authToken } : {}) },
          body: JSON.stringify({ text })
        });
        const data = await res.json();
        if (!res.ok) {
          if (data.upgrade) return alert(data.error);
          return alert(data.error || 'Analysis failed');
        }
        currentAnalysis = data;
        currentShareId = data.shareId;
        displayResults(data);
        document.getElementById('hero-section').classList.add('hidden');
      } catch(e) {
        alert('Analysis failed: ' + e.message);
      } finally {
        btn.disabled = false;
        btn.innerHTML = 'üîç Analyze Contract';
      }
    }

    function displayResults(data) {
      const rs = document.getElementById('results-section');
      rs.classList.add('visible');

      // Risk score animation
      const scoreEl = document.getElementById('risk-score');
      const barEl = document.getElementById('risk-bar');
      const labelEl = document.getElementById('risk-label');
      scoreEl.className = 'risk-score ' + data.riskLevel;
      barEl.className = 'risk-bar-fill ' + data.riskLevel;
      labelEl.textContent = data.riskLevel.toUpperCase() + ' RISK';
      labelEl.style.color = data.riskLevel === 'high' ? 'var(--red)' : data.riskLevel === 'medium' ? 'var(--orange)' : 'var(--green)';

      // Animate score
      let current = 0;
      const target = data.riskScore;
      const interval = setInterval(() => {
        current += Math.ceil(target / 30);
        if (current >= target) { current = target; clearInterval(interval); }
        scoreEl.textContent = current;
        barEl.style.width = current + '%';
      }, 30);

      // Doc type
      document.getElementById('result-doctype').innerHTML = `<span class="doc-type-badge">${data.documentType?.label || 'Unknown'}</span> <span style="color:var(--text-dim);font-size:0.8rem;margin-left:0.5rem">${data.wordCount?.toLocaleString()} words</span>`;

      // Parties
      if (data.parties?.length) {
        document.getElementById('parties-section').classList.remove('hidden');
        document.getElementById('parties-list').innerHTML = data.parties.map(p => `<span class="party-tag">${p}</span>`).join('');
      }

      // Risk Summary Card
      const summaryCard = document.getElementById('risk-summary-card');
      if (data.redFlags.length > 0) {
        const highFlags = data.redFlags.filter(f => f.severity === 'high');
        const topConcerns = data.redFlags.slice(0, 3).map(f => f.plainEnglish || f.description);
        const icon = data.riskLevel === 'high' ? 'üö®' : data.riskLevel === 'medium' ? '‚ö†Ô∏è' : '‚úÖ';
        summaryCard.className = `risk-summary-card ${data.riskLevel} fade-in`;
        summaryCard.classList.remove('hidden');
        summaryCard.innerHTML = `
          <div class="risk-summary-header">
            <div class="risk-summary-icon">${icon}</div>
            <div>
              <div class="risk-summary-title">This contract has ${data.redFlags.length} red flag${data.redFlags.length !== 1 ? 's' : ''}${highFlags.length ? ` (${highFlags.length} high severity)` : ''}</div>
              <span class="risk-overall ${data.riskLevel}">Overall Risk: ${data.riskLevel.toUpperCase()}</span>
            </div>
          </div>
          <div class="risk-summary-concerns">
            <div style="font-weight:600;font-size:0.85rem;color:var(--text-dim);margin-bottom:0.3rem">KEY CONCERNS:</div>
            ${topConcerns.map(c => `<div class="risk-summary-concern">${c}</div>`).join('')}
          </div>`;
      } else {
        summaryCard.className = 'risk-summary-card low fade-in';
        summaryCard.classList.remove('hidden');
        summaryCard.innerHTML = `<div class="risk-summary-header"><div class="risk-summary-icon">‚úÖ</div><div><div class="risk-summary-title">No major red flags detected</div><span class="risk-overall low">Overall Risk: LOW</span></div></div>`;
      }

      // Red flags
      const flagsHtml = data.redFlags.length === 0
        ? '<p style="color:var(--green);font-size:1rem">‚úÖ No major red flags detected! This contract looks relatively clean.</p>'
        : data.redFlags.map(f => `
          <div class="flag-item ${f.severity}">
            <div class="flag-header">
              <span class="flag-name">${f.name}</span>
              <span class="flag-severity ${f.severity}">${f.severity}</span>
            </div>
            <div class="flag-desc">${f.description}</div>
            ${f.plainEnglish ? `<div class="plain-english">${f.plainEnglish}</div>` : ''}
            ${f.context ? `<div class="flag-context">"${escHtml(f.context)}"</div>` : ''}
          </div>`).join('');
      document.getElementById('flags-list').innerHTML = `<h3>üö© ${data.redFlags.length} Red Flag${data.redFlags.length !== 1 ? 's' : ''} Found</h3>` + flagsHtml;

      // Recommendations
      document.getElementById('recs-list').innerHTML = '<h3>üí° Recommendations</h3>' + data.recommendations.map(r => `
        <div class="rec-item ${r.priority}">
          <span class="rec-icon">${r.priority === 'high' ? 'üî¥' : r.priority === 'medium' ? 'üü°' : 'üü¢'}</span>
          <span>${r.text}</span>
        </div>`).join('');

      // Key terms
      document.getElementById('terms-list').innerHTML = data.keyTerms.map(t => `<div class="term-tag"><span class="type">${t.type}</span>${escHtml(t.value)}</div>`).join('') || '<p style="color:var(--text-dim)">No specific financial or duration terms extracted.</p>';
      document.getElementById('dates-list').innerHTML = data.dates?.map(d => `<div class="term-tag"><span class="type">date</span>${d}</div>`).join('') || '<p style="color:var(--text-dim)">No specific dates found.</p>';

      // Obligations
      document.getElementById('obligations-list').innerHTML = '<h3>üìú Key Obligations</h3>' +
        (data.obligations?.length ? data.obligations.map(o => `<div class="obligation"><span class="obligation-strength ${o.strength}">${o.strength}</span>${escHtml(o.text)}</div>`).join('') : '<p style="color:var(--text-dim)">No specific obligations extracted.</p>');

      // Display annotated view
      if (data.clauseAnnotations) displayAnnotatedView(data.clauseAnnotations);
      if (data.negotiationPlaybook) displayNegotiationPlaybook(data.negotiationPlaybook);

      rs.scrollIntoView({ behavior: 'smooth' });
    }


    function displayAnnotatedView(clauseData) {
      if (!clauseData) return;
      const stats = clauseData.stats;
      const clauses = clauseData.clauses;
      
      // Stats bar
      document.getElementById('clause-stats').innerHTML = `
        <div class="clause-stat safe">üü¢ ${stats.safe} Safe</div>
        <div class="clause-stat caution">üü° ${stats.caution} Caution</div>
        <div class="clause-stat danger">üî¥ ${stats.danger} Danger</div>
        <div style="color:var(--text-dim);display:flex;align-items:center;font-size:0.85rem">${stats.total} clauses analyzed</div>
      `;
      
      // Filter bar + clauses
      let html = `<div class="clause-filter-bar">
        <button class="clause-filter-btn active" onclick="filterClauses('all',this)">All (${stats.total})</button>
        <button class="clause-filter-btn" onclick="filterClauses('red',this)">üî¥ Danger (${stats.danger})</button>
        <button class="clause-filter-btn" onclick="filterClauses('yellow',this)">üü° Caution (${stats.caution})</button>
        <button class="clause-filter-btn" onclick="filterClauses('green',this)">üü¢ Safe (${stats.safe})</button>
      </div>`;
      
      clauses.forEach((c, i) => {
        const expanded = c.risk === 'red' ? ' expanded' : '';
        const riskWord = c.risk === 'red' ? 'Danger' : c.risk === 'yellow' ? 'Caution' : 'Safe';
        let annotationsHtml = '';
        
        if (c.annotations.length > 0) {
          c.annotations.forEach(a => {
            annotationsHtml += `<div class="clause-annotation ${a.risk}">
              <div class="annotation-label ${a.risk}">${a.risk === 'red' ? 'üî¥' : a.risk === 'yellow' ? 'üü°' : 'üü¢'} ${a.label}</div>
              <div class="annotation-detail"><strong>What it means:</strong> ${a.explanation}</div>
              <div class="annotation-detail"><strong>Watch out:</strong> ${a.concern}</div>
              ${a.alternative ? `<div class="annotation-alternative">${a.alternative}</div>` : ''}
            </div>`;
          });
        } else {
          annotationsHtml = '<div class="annotation-detail" style="color:#10b981;padding:0.5rem 0">‚úÖ No specific concerns identified in this clause.</div>';
        }
        
        html += `<div class="clause-item risk-${c.risk}${expanded}" data-risk="${c.risk}">
          <div class="clause-header" onclick="this.parentElement.classList.toggle('expanded')">
            <div class="clause-risk-dot ${c.risk}"></div>
            <div class="clause-title">${escHtml(c.title)}</div>
            <span class="clause-risk-label ${c.risk}">${riskWord}</span>
            <span class="clause-chevron">‚ñº</span>
          </div>
          <div class="clause-body">
            <div class="clause-text">${escHtml(c.text)}</div>
            ${annotationsHtml}
          </div>
        </div>`;
      });
      
      document.getElementById('annotated-clauses').innerHTML = html;
    }
    
    function filterClauses(risk, btn) {
      document.querySelectorAll('.clause-filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      document.querySelectorAll('.clause-item').forEach(el => {
        if (risk === 'all' || el.dataset.risk === risk) {
          el.style.display = '';
        } else {
          el.style.display = 'none';
        }
      });
    }

    function showResultTab(tab) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('[id^="tab-"]').forEach(t => t.classList.add('hidden'));
      event.target.classList.add('active');
      document.getElementById('tab-' + tab).classList.remove('hidden');
    }

    function newAnalysis() {
      document.getElementById('results-section').classList.remove('visible');
      document.getElementById('hero-section').classList.remove('hidden');
      document.getElementById('contract-text').value = '';
      document.getElementById('parties-section').classList.add('hidden');
      document.getElementById('share-section').classList.add('hidden');
      document.getElementById('risk-summary-card').classList.add('hidden');
      document.getElementById('email-export-section').classList.add('hidden');
      currentAnalysis = null;
      currentShareId = null;
      scrollToInput();
    }

    // ========== SAMPLES ==========
    async function loadSample(id) {
      try {
        const res = await fetch('/api/samples/' + id);
        const data = await res.json();
        document.getElementById('contract-text').value = data.text;
        sampleContracts[id] = data;
        scrollToInput();
      } catch(e) { alert('Failed to load sample'); }
    }

    async function previewSample(id) {
      try {
        const res = await fetch('/api/samples/' + id);
        const data = await res.json();
        sampleContracts[id] = data;
        document.getElementById('sample-preview').classList.remove('hidden');
        document.getElementById('sample-preview-title').textContent = data.icon + ' ' + data.name;
        document.getElementById('sample-preview-text').textContent = data.text;
        document.getElementById('sample-preview').dataset.id = id;
        document.getElementById('sample-preview').scrollIntoView({ behavior: 'smooth' });
      } catch(e) { alert('Failed to load sample'); }
    }

    function analyzeSamplePreview() {
      const id = document.getElementById('sample-preview').dataset.id;
      if (sampleContracts[id]) {
        showPage('home');
        document.getElementById('contract-text').value = sampleContracts[id].text;
        runAnalysis();
      }
    }

    // ========== FILE UPLOAD ==========
    document.addEventListener('DOMContentLoaded', () => {
      const area = document.getElementById('upload-area');
      const input = document.getElementById('file-input');

      area.addEventListener('dragover', e => { e.preventDefault(); area.classList.add('dragover'); });
      area.addEventListener('dragleave', () => area.classList.remove('dragover'));
      area.addEventListener('drop', e => { e.preventDefault(); area.classList.remove('dragover'); if (e.dataTransfer.files[0]) uploadFile(e.dataTransfer.files[0]); });
      input.addEventListener('change', e => { if (e.target.files[0]) uploadFile(e.target.files[0]); });
    });

    async function uploadFile(file) {
      const form = new FormData();
      form.append('file', file);
      const area = document.getElementById('upload-area');
      area.innerHTML = '<div class="upload-icon"><span class="spinner"></span></div><div class="upload-text">Processing...</div>';
      try {
        const res = await fetch('/api/upload', { method: 'POST', body: form });
        const data = await res.json();
        if (data.text) {
          document.getElementById('contract-text').value = data.text;
          area.innerHTML = '<div class="upload-icon">‚úÖ</div><div class="upload-text">File loaded! Click Analyze to proceed.</div>';
        } else {
          area.innerHTML = '<div class="upload-icon">‚ùå</div><div class="upload-text">' + (data.error || 'Upload failed') + '</div>';
        }
      } catch(e) {
        area.innerHTML = '<div class="upload-icon">‚ùå</div><div class="upload-text">Upload failed</div>';
      }
    }

    // ========== COMPARE ==========
    async function runComparison() {
      const text1 = document.getElementById('compare-text1').value.trim();
      const text2 = document.getElementById('compare-text2').value.trim();
      if (text1.length < 50 || text2.length < 50) return alert('Please paste both contracts (at least 50 characters each).');

      const btn = document.getElementById('compare-btn');
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner"></span> Comparing...';

      try {
        const res = await fetch('/api/compare', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', ...(authToken ? { Authorization: 'Bearer ' + authToken } : {}) },
          body: JSON.stringify({ text1, text2 })
        });
        const data = await res.json();
        if (!res.ok) return alert(data.error || 'Comparison failed');
        displayComparison(data);
      } catch(e) {
        alert('Comparison failed: ' + e.message);
      } finally {
        btn.disabled = false;
        btn.innerHTML = 'üîÑ Compare Contracts';
      }
    }

    function displayComparison(data) {
      const el = document.getElementById('compare-results');
      el.classList.remove('hidden');

      const c1 = data.contract1, c2 = data.contract2, cmp = data.comparison;
      const saferLabel = cmp.safer === 'contract1' ? 'Contract 1' : 'Contract 2';
      const riskierLabel = cmp.safer === 'contract1' ? 'Contract 2' : 'Contract 1';

      el.innerHTML = `
        <div class="card fade-in">
          <h2>üìä Comparison Results</h2>
          <div class="compare-grid" style="margin-top:1.5rem">
            <div style="text-align:center">
              <h3>Contract 1</h3>
              <div class="doc-type-badge" style="margin:0.5rem auto">${c1.documentType?.label}</div>
              <div class="risk-score ${c1.riskLevel}" style="font-size:3rem">${c1.riskScore}</div>
              <div style="color:${c1.riskLevel==='high'?'var(--red)':c1.riskLevel==='medium'?'var(--orange)':'var(--green)'};font-weight:700">${c1.riskLevel.toUpperCase()} RISK</div>
              <div style="color:var(--text-muted);font-size:0.85rem;margin-top:0.5rem">${c1.redFlags.length} red flags</div>
            </div>
            <div style="text-align:center">
              <h3>Contract 2</h3>
              <div class="doc-type-badge" style="margin:0.5rem auto">${c2.documentType?.label}</div>
              <div class="risk-score ${c2.riskLevel}" style="font-size:3rem">${c2.riskScore}</div>
              <div style="color:${c2.riskLevel==='high'?'var(--red)':c2.riskLevel==='medium'?'var(--orange)':'var(--green)'};font-weight:700">${c2.riskLevel.toUpperCase()} RISK</div>
              <div style="color:var(--text-muted);font-size:0.85rem;margin-top:0.5rem">${c2.redFlags.length} red flags</div>
            </div>
          </div>
          <div style="text-align:center;margin-top:2rem;padding:1.5rem;background:var(--surface2);border-radius:12px">
            <div style="font-size:1.3rem;font-weight:700">üèÜ ${saferLabel} is safer</div>
            <div style="color:var(--text-muted);margin-top:0.5rem">${cmp.summary.join(' ')}</div>
          </div>
          ${cmp.flagsOnlyInFirst.length ? `<div style="margin-top:1.5rem"><h3>üö© Only in Contract 1</h3>${cmp.flagsOnlyInFirst.map(f => `<div class="flag-item ${f.severity}" style="margin-top:0.5rem"><span class="flag-name">${f.name}</span> <span class="flag-severity ${f.severity}">${f.severity}</span><br><span class="flag-desc">${f.description}</span></div>`).join('')}</div>` : ''}
          ${cmp.flagsOnlyInSecond.length ? `<div style="margin-top:1.5rem"><h3>üö© Only in Contract 2</h3>${cmp.flagsOnlyInSecond.map(f => `<div class="flag-item ${f.severity}" style="margin-top:0.5rem"><span class="flag-name">${f.name}</span> <span class="flag-severity ${f.severity}">${f.severity}</span><br><span class="flag-desc">${f.description}</span></div>`).join('')}</div>` : ''}
          ${cmp.flagsInBoth.length ? `<div style="margin-top:1.5rem"><h3>‚ö†Ô∏è In Both Contracts</h3>${cmp.flagsInBoth.map(f => `<div class="flag-item ${f.severity}" style="margin-top:0.5rem"><span class="flag-name">${f.name}</span> <span class="flag-severity ${f.severity}">${f.severity}</span></div>`).join('')}</div>` : ''}
        </div>`;
      el.scrollIntoView({ behavior: 'smooth' });
    }

    // ========== SHARE ==========
    function shareResult() {
      if (!currentShareId) return;
      const url = location.origin + '/share/' + currentShareId;
      document.getElementById('share-url').value = url;
      document.getElementById('share-section').classList.remove('hidden');
    }

    function copyShareUrl() {
      const input = document.getElementById('share-url');
      input.select();
      navigator.clipboard.writeText(input.value);
      event.target.textContent = 'Copied!';
      setTimeout(() => event.target.textContent = 'Copy', 2000);
    }

    async function loadSharedResult(id) {
      try {
        const res = await fetch('/api/share/' + id);
        if (!res.ok) return;
        const data = await res.json();
        if (data.analysis) {
          currentAnalysis = data.analysis;
          currentShareId = id;
          showPage('home');
          document.getElementById('hero-section').classList.add('hidden');
          displayResults(data.analysis);
        }
      } catch(e) {}
    }

    // ========== EXPORT ==========
    async function exportPDF() {
      if (!currentAnalysis) return;
      try {
        const res = await fetch('/api/export-pdf', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ analysis: currentAnalysis })
        });
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'briefpulse-report.html';
        a.click();
        URL.revokeObjectURL(url);
      } catch(e) { alert('Export failed'); }
    }

    // ========== AUTH ==========
    function showAuthModal(mode) {
      authMode = mode || 'login';
      document.getElementById('auth-modal').classList.add('visible');
      document.getElementById('auth-modal-title').textContent = authMode === 'login' ? 'Log In' : 'Sign Up';
      document.getElementById('auth-submit-btn').textContent = authMode === 'login' ? 'Log In' : 'Sign Up';
      document.getElementById('auth-name-group').style.display = authMode === 'signup' ? 'block' : 'none';
      document.getElementById('auth-toggle-text').textContent = authMode === 'login' ? "Don't have an account? " : "Already have an account? ";
      document.getElementById('auth-toggle-link').textContent = authMode === 'login' ? 'Sign up' : 'Log in';
      document.getElementById('auth-error').textContent = '';
    }

    function closeAuthModal() {
      document.getElementById('auth-modal').classList.remove('visible');
    }

    function toggleAuthMode() {
      showAuthModal(authMode === 'login' ? 'signup' : 'login');
    }

    async function submitAuth() {
      const email = document.getElementById('auth-email').value;
      const password = document.getElementById('auth-password').value;
      const name = document.getElementById('auth-name').value;
      if (!email || !password) return document.getElementById('auth-error').textContent = 'Email and password required.';

      const endpoint = authMode === 'login' ? '/api/auth/login' : '/api/auth/signup';
      try {
        const res = await fetch(endpoint, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password, name })
        });
        const data = await res.json();
        if (!res.ok) return document.getElementById('auth-error').textContent = data.error;
        authToken = data.token;
        localStorage.setItem('bp_token', authToken);
        currentUser = data.user;
        updateAuthUI();
        closeAuthModal();
      } catch(e) {
        document.getElementById('auth-error').textContent = 'Connection failed.';
      }
    }

    function updateAuthUI() {
      const nav = document.getElementById('auth-nav');
      if (currentUser) {
        nav.innerHTML = `<span style="color:var(--text-muted);font-size:0.85rem">${escHtml(currentUser.name || currentUser.email)}</span> <button class="nav-btn" onclick="showPage('account')">Account</button> <button style="color:var(--text-dim);background:none;border:none;cursor:pointer;font-family:inherit;font-size:0.85rem" onclick="logout()">Logout</button>`;
      } else {
        nav.innerHTML = `<button class="nav-btn" onclick="showAuthModal('login')">Log In</button>`;
      }
    }

    async function logout() {
      await fetch('/api/auth/logout', { method: 'POST', headers: { Authorization: 'Bearer ' + authToken } });
      authToken = null;
      currentUser = null;
      localStorage.removeItem('bp_token');
      updateAuthUI();
      showPage('home');
    }

    async function loadAccount() {
      if (!authToken) return;
      try {
        const res = await fetch('/api/auth/me', { headers: { Authorization: 'Bearer ' + authToken } });
        const data = await res.json();
        if (res.ok) {
          currentUser = data;
          document.getElementById('account-info').innerHTML = `<h2>üë§ ${escHtml(data.name || 'User')}</h2><p style="color:var(--text-muted)">${escHtml(data.email)}</p><p style="margin-top:0.5rem;color:var(--text-dim);font-size:0.85rem">${data.analyses?.length || 0} analyses saved</p>`;
          const hist = document.getElementById('analysis-history');
          if (data.analyses?.length) {
            hist.innerHTML = data.analyses.map(a => `
              <div class="history-item">
                <div class="history-meta">
                  <strong>${a.documentType || 'Contract'}</strong><br>
                  <span style="color:var(--text-dim);font-size:0.8rem">${new Date(a.createdAt).toLocaleDateString()} ¬∑ ${a.redFlagCount} flags</span>
                </div>
                <div class="history-risk" style="color:${a.riskScore>=70?'var(--red)':a.riskScore>=40?'var(--orange)':'var(--green)'}">${a.riskScore}/100</div>
              </div>`).join('');
          } else {
            hist.innerHTML = '<p style="color:var(--text-dim);text-align:center;padding:2rem">No analyses yet. Analyze a contract to see it here!</p>';
          }
        }
      } catch(e) {}
    }

    // ========== CHECKOUT ==========
    async function checkout(plan) {
      try {
        const res = await fetch('/api/checkout', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ plan })
        });
        const data = await res.json();
        if (data.url) window.location.href = data.url;
      } catch(e) { alert('Payment setup failed'); }
    }

    // ========== DEMO ==========
    async function runDemo() {
      // Auto-analyze the freelance contract for the demo section
      try {
        const res = await fetch('/api/samples/freelance');
        const sample = await res.json();
        const analysisRes = await fetch('/api/analyze', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text: sample.text })
        });
        const analysis = await analysisRes.json();
        if (analysis.riskScore) {
          const riskColor = analysis.riskLevel === 'high' ? 'var(--red)' : analysis.riskLevel === 'medium' ? 'var(--orange)' : 'var(--green)';
          document.getElementById('demo-output').innerHTML = `
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem">
              <div>
                <span class="doc-type-badge">${analysis.documentType?.label}</span>
                <span style="color:var(--text-dim);font-size:0.8rem;margin-left:0.5rem">${analysis.wordCount} words</span>
              </div>
              <div style="text-align:right">
                <div style="font-size:2rem;font-weight:800;color:${riskColor}">${analysis.riskScore}/100</div>
                <div style="color:${riskColor};font-weight:600;font-size:0.8rem">${analysis.riskLevel.toUpperCase()} RISK</div>
              </div>
            </div>
            <div style="font-weight:700;margin-bottom:0.75rem">üö© ${analysis.redFlags.length} Red Flags Found:</div>
            ${analysis.redFlags.slice(0, 5).map(f => `
              <div class="flag-item ${f.severity}" style="margin-bottom:0.5rem">
                <div class="flag-header"><span class="flag-name">${f.name}</span><span class="flag-severity ${f.severity}">${f.severity}</span></div>
                <div class="flag-desc">${f.description}</div>
              </div>`).join('')}
            ${analysis.redFlags.length > 5 ? `<p style="color:var(--text-dim);text-align:center">...and ${analysis.redFlags.length - 5} more</p>` : ''}
            <div style="text-align:center;margin-top:1.5rem">
              <button class="btn btn-primary" onclick="scrollToInput()">Try It Yourself ‚Äî Free</button>
            </div>`;
        }
      } catch(e) {
        document.getElementById('demo-section').style.display = 'none';
      }
    }

    // ========== COPY TO CLIPBOARD ==========
    function copyToClipboard() {
      if (!currentAnalysis) return;
      const a = currentAnalysis;
      let md = `# BriefPulse Contract Analysis Report\n\n`;
      md += `**Document Type:** ${a.documentType?.label || 'Unknown'}\n`;
      md += `**Risk Score:** ${a.riskScore}/100 ‚Äî ${a.riskLevel?.toUpperCase()} RISK\n`;
      md += `**Red Flags:** ${a.redFlags.length}\n\n`;
      if (a.parties?.length) md += `**Parties:** ${a.parties.join(', ')}\n\n`;
      md += `## Red Flags\n\n`;
      a.redFlags.forEach(f => {
        md += `### üö© ${f.name} (${f.severity})\n${f.description}\n`;
        if (f.plainEnglish) md += `> üí° ${f.plainEnglish}\n`;
        md += `\n`;
      });
      md += `## Recommendations\n\n`;
      a.recommendations.forEach(r => { md += `- **[${r.priority}]** ${r.text}\n`; });
      if (a.keyTerms?.length) {
        md += `\n## Key Terms\n\n`;
        a.keyTerms.forEach(t => { md += `- ${t.type}: ${t.value}\n`; });
      }
      md += `\n---\n*Generated by BriefPulse ‚Äî https://delta.abapture.ai*\n`;
      navigator.clipboard.writeText(md).then(() => {
        const btn = event.target;
        btn.textContent = '‚úÖ Copied!';
        setTimeout(() => btn.textContent = 'üìã Copy', 2000);
      });
    }

    // ========== EMAIL EXPORT ==========
    function toggleEmailExport() {
      const el = document.getElementById('email-export-section');
      el.classList.toggle('hidden');
      if (!el.classList.contains('hidden')) document.getElementById('email-export-input').focus();
    }

    function sendEmailReport() {
      const email = document.getElementById('email-export-input').value.trim();
      if (!email || !email.includes('@')) return document.getElementById('email-status').textContent = 'Please enter a valid email.';
      if (!currentAnalysis) return;
      // Generate mailto with report summary
      const a = currentAnalysis;
      const subject = encodeURIComponent(`BriefPulse Report: ${a.documentType?.label || 'Contract'} Analysis (Risk: ${a.riskScore}/100)`);
      let body = `BriefPulse Contract Analysis Report\n\n`;
      body += `Document Type: ${a.documentType?.label || 'Unknown'}\n`;
      body += `Risk Score: ${a.riskScore}/100 ‚Äî ${a.riskLevel?.toUpperCase()} RISK\n`;
      body += `Red Flags: ${a.redFlags.length}\n\n`;
      body += `--- RED FLAGS ---\n\n`;
      a.redFlags.forEach(f => {
        body += `[${f.severity.toUpperCase()}] ${f.name}\n${f.description}\n`;
        if (f.plainEnglish) body += `What this means: ${f.plainEnglish}\n`;
        body += `\n`;
      });
      body += `--- RECOMMENDATIONS ---\n\n`;
      a.recommendations.forEach(r => { body += `[${r.priority}] ${r.text}\n`; });
      body += `\n---\nGenerated by BriefPulse ‚Äî https://delta.abapture.ai\nThis is informational only, not legal advice.\n`;
      window.open(`mailto:${encodeURIComponent(email)}?subject=${subject}&body=${encodeURIComponent(body)}`);
      document.getElementById('email-status').textContent = '‚úÖ Opening email client...';
      setTimeout(() => document.getElementById('email-status').textContent = '', 3000);
    }

    // ========== GLOSSARY ==========
    let glossaryData = [];

    async function loadGlossary() {
      if (glossaryData.length) return;
      try {
        const res = await fetch('/api/glossary');
        glossaryData = await res.json();
        renderGlossary(glossaryData);
      } catch(e) {}
    }

    function renderGlossary(items) {
      document.getElementById('glossary-count').textContent = `${items.length} terms`;
      document.getElementById('glossary-list').innerHTML = items.map(g => `
        <div class="glossary-item">
          <div class="glossary-term">${escHtml(g.term)}</div>
          ${g.aka ? `<div class="glossary-aka">Also known as: ${escHtml(g.aka)}</div>` : ''}
          <div class="glossary-def">${escHtml(g.definition)}</div>
          ${g.example ? `<div class="glossary-example">${escHtml(g.example)}</div>` : ''}
        </div>`).join('');
    }

    document.addEventListener('DOMContentLoaded', () => {
      const searchInput = document.getElementById('glossary-search');
      if (searchInput) {
        searchInput.addEventListener('input', (e) => {
          const q = e.target.value.toLowerCase();
          if (!q) return renderGlossary(glossaryData);
          const filtered = glossaryData.filter(g => g.term.toLowerCase().includes(q) || g.aka?.toLowerCase().includes(q) || g.definition.toLowerCase().includes(q));
          renderGlossary(filtered);
        });
      }
    });

    // ========== UTILS ==========
    function escHtml(s) { const d = document.createElement('div'); d.textContent = s || ''; return d.innerHTML; }

    // ========== BULK UPLOAD ==========
    let bulkFiles = []; // [{filename, text, error}]
    let bulkResults = null;

    document.addEventListener('DOMContentLoaded', () => {
      const area = document.getElementById('bulk-upload-area');
      const input = document.getElementById('bulk-file-input');
      if (!area) return;
      area.onclick = () => input.click();
      area.addEventListener('dragover', e => { e.preventDefault(); area.classList.add('dragover'); });
      area.addEventListener('dragleave', () => area.classList.remove('dragover'));
      area.addEventListener('drop', e => { e.preventDefault(); area.classList.remove('dragover'); handleBulkFiles(e.dataTransfer.files); });
      input.addEventListener('change', e => { handleBulkFiles(e.target.files); e.target.value=''; });
    });

    async function handleBulkFiles(fileList) {
      if (!fileList.length) return;
      const form = new FormData();
      for (const f of fileList) form.append('files', f);
      const area = document.getElementById('bulk-upload-area');
      area.innerHTML = '<div class="upload-icon"><span class="spinner"></span></div><div class="upload-text">Processing files...</div>';
      try {
        const res = await fetch('/api/bulk-upload', { method: 'POST', body: form });
        const data = await res.json();
        if (data.files) {
          data.files.forEach(f => {
            if (!bulkFiles.find(bf => bf.filename === f.filename)) bulkFiles.push(f);
          });
          renderBulkQueue();
        }
      } catch(e) { alert('Upload failed: ' + e.message); }
      area.innerHTML = '<div class="upload-icon" style="font-size:3rem">üìÇ</div><div style="font-size:1.1rem;font-weight:600;margin-bottom:0.3rem">Drop more files here</div><div class="upload-text">or click to select files</div>';
    }

    function renderBulkQueue() {
      const q = document.getElementById('bulk-queue');
      const list = document.getElementById('bulk-queue-list');
      const count = document.getElementById('bulk-queue-count');
      if (bulkFiles.length === 0) { q.classList.add('hidden'); return; }
      q.classList.remove('hidden');
      const ready = bulkFiles.filter(f => !f.error).length;
      count.textContent = `${ready} ready, ${bulkFiles.length - ready} errors`;
      list.innerHTML = bulkFiles.map((f, i) => `
        <div class="bulk-file-item">
          <span>üìÑ ${escHtml(f.filename)}</span>
          <div style="display:flex;align-items:center;gap:0.75rem">
            <span class="status ${f.error ? 'error' : 'ready'}">${f.error ? '‚ùå ' + f.error : '‚úÖ Ready'}</span>
            <button class="remove-btn" onclick="removeBulkFile(${i})">√ó</button>
          </div>
        </div>`).join('');
    }

    function removeBulkFile(i) { bulkFiles.splice(i, 1); renderBulkQueue(); }
    function clearBulkQueue() { bulkFiles = []; renderBulkQueue(); }

    async function runBulkAnalysis() {
      const ready = bulkFiles.filter(f => !f.error);
      if (ready.length === 0) return alert('No valid files to analyze.');
      const btn = document.getElementById('bulk-analyze-btn');
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner"></span> Analyzing...';
      document.getElementById('bulk-progress').classList.remove('hidden');

      // Simulate progress
      let pct = 0;
      const pi = setInterval(() => {
        pct = Math.min(pct + Math.random() * 15, 90);
        document.getElementById('bulk-progress-bar').style.width = pct + '%';
        document.getElementById('bulk-progress-text').textContent = Math.round(pct) + '%';
      }, 200);

      try {
        const res = await fetch('/api/bulk-analyze', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', ...(authToken ? { Authorization: 'Bearer ' + authToken } : {}) },
          body: JSON.stringify({ contracts: ready.map(f => ({ filename: f.filename, text: f.text })) })
        });
        const data = await res.json();
        if (!res.ok) { alert(data.error || 'Analysis failed'); return; }
        clearInterval(pi);
        document.getElementById('bulk-progress-bar').style.width = '100%';
        document.getElementById('bulk-progress-text').textContent = '100%';
        bulkResults = data;
        setTimeout(() => {
          document.getElementById('bulk-progress').classList.add('hidden');
          displayBulkDashboard(data);
        }, 500);
      } catch(e) {
        clearInterval(pi);
        alert('Analysis failed: ' + e.message);
      } finally {
        btn.disabled = false;
        btn.innerHTML = 'üîç Analyze All';
      }
    }

    function displayBulkDashboard(data) {
      const { summary, results } = data;
      document.getElementById('bulk-queue').classList.add('hidden');
      document.getElementById('bulk-dashboard').classList.remove('hidden');

      // Stats
      const avgColor = summary.avgRiskScore >= 70 ? 'var(--red)' : summary.avgRiskScore >= 40 ? 'var(--orange)' : 'var(--green)';
      document.getElementById('bulk-stats').innerHTML = `
        <div class="bulk-stat-card"><div class="bulk-stat-num" style="color:var(--accent)">${summary.analyzed}</div><div class="bulk-stat-label">Contracts Analyzed</div></div>
        <div class="bulk-stat-card"><div class="bulk-stat-num" style="color:${avgColor}">${summary.avgRiskScore}</div><div class="bulk-stat-label">Avg Risk Score</div></div>
        <div class="bulk-stat-card"><div class="bulk-stat-num" style="color:var(--red)">${summary.totalRedFlags}</div><div class="bulk-stat-label">Total Red Flags</div></div>
        <div class="bulk-stat-card"><div class="bulk-stat-num" style="color:var(--red)">${summary.highRisk}</div><div class="bulk-stat-label">High Risk</div></div>`;

      // Risk distribution chart
      const maxCount = Math.max(summary.highRisk, summary.mediumRisk, summary.lowRisk, 1);
      document.getElementById('bulk-risk-chart').innerHTML = `
        <div class="bulk-bar-row"><div class="bulk-bar-label" style="color:var(--red)">üî¥ High</div><div class="bulk-bar-track"><div class="bulk-bar-fill" style="width:${(summary.highRisk/maxCount)*100}%;background:var(--red)">${summary.highRisk}</div></div></div>
        <div class="bulk-bar-row"><div class="bulk-bar-label" style="color:var(--orange)">üü° Medium</div><div class="bulk-bar-track"><div class="bulk-bar-fill" style="width:${(summary.mediumRisk/maxCount)*100}%;background:var(--orange)">${summary.mediumRisk}</div></div></div>
        <div class="bulk-bar-row"><div class="bulk-bar-label" style="color:var(--green)">üü¢ Low</div><div class="bulk-bar-track"><div class="bulk-bar-fill" style="width:${(summary.lowRisk/maxCount)*100}%;background:var(--green)">${summary.lowRisk}</div></div></div>`;

      // Common flags
      const cf = document.getElementById('bulk-common-flags');
      if (summary.commonFlags.length === 0) {
        cf.innerHTML = '<p style="color:var(--green)">‚úÖ No red flags found across any contracts!</p>';
      } else {
        cf.innerHTML = summary.commonFlags.slice(0, 10).map(f => {
          const sColor = f.severity === 'high' ? 'var(--red)' : f.severity === 'medium' ? 'var(--orange)' : 'var(--blue)';
          return `<div style="display:flex;align-items:center;gap:0.75rem;padding:0.6rem 0;border-bottom:1px solid var(--border)">
            <span style="font-weight:700;min-width:2rem;text-align:center;font-size:1.2rem;color:${sColor}">${f.count}</span>
            <span style="flex:1">${f.name}</span>
            <span class="flag-severity ${f.severity}">${f.severity}</span>
          </div>`;
        }).join('');
      }

      // Ranking
      document.getElementById('bulk-ranking').innerHTML = summary.ranking.map((r, i) => {
        const color = r.riskLevel === 'high' ? 'var(--red)' : r.riskLevel === 'medium' ? 'var(--orange)' : 'var(--green)';
        return `<div class="bulk-rank-item ${r.riskLevel}">
          <div class="bulk-rank-num">#${i + 1}</div>
          <div class="bulk-rank-info">
            <div style="font-weight:600">${escHtml(r.filename)}</div>
            <div style="font-size:0.8rem;color:var(--text-muted)">${r.documentType || 'Unknown'} ¬∑ ${r.redFlagCount} red flags</div>
          </div>
          <div class="bulk-rank-score" style="color:${color}">${r.riskScore}/100</div>
        </div>`;
      }).join('');

      // Individual details (collapsible)
      const valid = results.filter(r => r.analysis);
      document.getElementById('bulk-details').innerHTML = valid.map((r, i) => {
        const a = r.analysis;
        const color = a.riskLevel === 'high' ? 'var(--red)' : a.riskLevel === 'medium' ? 'var(--orange)' : 'var(--green)';
        return `<div class="bulk-detail-card ${a.riskLevel}">
          <div class="bulk-detail-header" onclick="this.nextElementSibling.classList.toggle('open')">
            <div>
              <span style="font-weight:700">${escHtml(r.filename)}</span>
              <span class="doc-type-badge" style="margin-left:0.5rem;font-size:0.75rem;padding:0.15rem 0.5rem">${a.documentType?.label || 'Unknown'}</span>
            </div>
            <div style="display:flex;align-items:center;gap:1rem">
              <span style="color:var(--text-muted);font-size:0.85rem">${a.redFlags.length} flags</span>
              <span style="font-weight:800;font-size:1.2rem;color:${color}">${a.riskScore}</span>
              <span style="color:var(--text-dim)">‚ñº</span>
            </div>
          </div>
          <div class="bulk-detail-body">
            ${a.redFlags.length ? a.redFlags.map(f => `
              <div class="flag-item ${f.severity}" style="margin-bottom:0.5rem">
                <div class="flag-header"><span class="flag-name">${f.name}</span><span class="flag-severity ${f.severity}">${f.severity}</span></div>
                <div class="flag-desc">${f.description}</div>
                ${f.plainEnglish ? `<div class="plain-english">${f.plainEnglish}</div>` : ''}
              </div>`).join('') : '<p style="color:var(--green)">‚úÖ No red flags detected</p>'}
            ${a.recommendations.length ? '<h4 style="margin-top:1rem;margin-bottom:0.5rem">üí° Recommendations</h4>' + a.recommendations.map(rec => `<div class="rec-item ${rec.priority}"><span class="rec-icon">${rec.priority==='high'?'üî¥':rec.priority==='medium'?'üü°':'üü¢'}</span><span>${rec.text}</span></div>`).join('') : ''}
          </div>
        </div>`;
      }).join('');

      document.getElementById('bulk-dashboard').scrollIntoView({ behavior: 'smooth' });
    }

    function clearBulkResults() {
      bulkFiles = [];
      bulkResults = null;
      document.getElementById('bulk-dashboard').classList.add('hidden');
      document.getElementById('bulk-queue').classList.add('hidden');
      renderBulkQueue();
    }


    // ========== NEGOTIATION PLAYBOOK ==========
    function displayNegotiationPlaybook(playbook) {
      if (!playbook || !playbook.suggestions.length) {
        document.getElementById('negotiation-content').innerHTML = '<p style="color:var(--green);font-size:1rem">‚úÖ No negotiation points needed ‚Äî this contract looks fair!</p>';
        return;
      }

      const s = playbook.summary;
      let html = '';

      // Copy button bar
      html += '<div class="neg-copy-bar">';
      html += '<button class="btn btn-primary btn-sm" onclick="copyNegotiationEmail()">‚úâÔ∏è Copy negotiation points as email draft</button>';
      html += '<button class="btn btn-secondary btn-sm" onclick="copyNegotiationBullets()">üìã Copy as bullet points</button>';
      html += '</div>';

      // Stats
      html += '<div class="neg-stats">';
      if (s.mustNegotiate > 0) html += '<div class="neg-stat must">üî¥ ' + s.mustNegotiate + ' Must-Negotiate</div>';
      if (s.shouldNegotiate > 0) html += '<div class="neg-stat should">üü° ' + s.shouldNegotiate + ' Should-Negotiate</div>';
      if (s.niceToHave > 0) html += '<div class="neg-stat nice">üîµ ' + s.niceToHave + ' Nice-to-Have</div>';
      html += '</div>';

      // Group by priority
      const groups = {
        'must-negotiate': { label: 'üî¥ Must-Negotiate', desc: 'These issues pose significant risk and should be addressed before signing.', items: [] },
        'should-negotiate': { label: 'üü° Should-Negotiate', desc: 'Important items that would strengthen your position.', items: [] },
        'nice-to-have': { label: 'üîµ Nice-to-Have', desc: 'Lower priority but worth raising if the negotiation is going well.', items: [] }
      };

      playbook.suggestions.forEach(item => {
        if (groups[item.priority]) groups[item.priority].items.push(item);
      });

      for (const [priority, group] of Object.entries(groups)) {
        if (group.items.length === 0) continue;
        html += '<div class="neg-priority-group">';
        html += '<div class="neg-priority-header">';
        html += '<span class="neg-priority-badge ' + priority + '">' + group.label + '</span>';
        html += '<span style="color:var(--text-dim);font-size:0.85rem">' + group.desc + '</span>';
        html += '</div>';

        group.items.forEach(item => {
          html += '<div class="neg-item">';
          html += '<div class="neg-item-header">';
          html += '<span class="neg-item-title">' + escHtml(item.flagName) + '</span>';
          html += '<span class="flag-severity ' + item.severity + '">' + item.severity + '</span>';
          html += '</div>';

          if (item.problematicClause) {
            html += '<div class="neg-section"><div class="neg-section-label">Problematic Clause</div>';
            html += '<div class="neg-clause-text">"' + escHtml(item.problematicClause) + '"</div></div>';
          }

          html += '<div class="neg-section"><div class="neg-section-label">Why It\'s Risky</div>';
          html += '<div class="neg-risk-text">' + escHtml(item.whyRisky) + '</div></div>';

          if (item.suggestedLanguage) {
            html += '<div class="neg-section"><div class="neg-section-label">Suggested Alternative Language</div>';
            html += '<div class="neg-suggested">' + escHtml(item.suggestedLanguage) + '</div></div>';
          }

          html += '<div class="neg-section"><div class="neg-section-label">Negotiation Tip</div>';
          html += '<div class="neg-tip">' + escHtml(item.negotiationTip) + '</div></div>';

          if (item.leveragePoints && item.leveragePoints.length) {
            html += '<div class="neg-section"><div class="neg-section-label">Leverage Points</div>';
            html += '<ul class="neg-leverage">';
            item.leveragePoints.forEach(lp => {
              html += '<li>' + escHtml(lp) + '</li>';
            });
            html += '</ul></div>';
          }

          html += '</div>'; // neg-item
        });

        html += '</div>'; // neg-priority-group
      }

      document.getElementById('negotiation-content').innerHTML = html;
    }

    function copyNegotiationEmail() {
      if (!currentAnalysis || !currentAnalysis.negotiationPlaybook) return;
      const pb = currentAnalysis.negotiationPlaybook;
      const docType = currentAnalysis.documentType?.label || 'the contract';

      let email = 'Subject: Requested Amendments to ' + docType + '\n\n';
      email += 'Dear [Counterparty Name],\n\n';
      email += 'Thank you for sending over ' + docType.toLowerCase() + ' for review. After careful consideration, I would like to discuss the following points before we proceed:\n\n';

      let num = 1;
      const mustItems = pb.suggestions.filter(s => s.priority === 'must-negotiate');
      const shouldItems = pb.suggestions.filter(s => s.priority === 'should-negotiate');
      const niceItems = pb.suggestions.filter(s => s.priority === 'nice-to-have');

      if (mustItems.length > 0) {
        email += '--- CRITICAL ITEMS (Must Address) ---\n\n';
        mustItems.forEach(item => {
          email += num + '. ' + item.flagName + '\n';
          email += '   Current concern: ' + item.whyRisky + '\n';
          if (item.suggestedLanguage) {
            email += '   Proposed revision: ' + item.suggestedLanguage + '\n';
          }
          email += '\n';
          num++;
        });
      }

      if (shouldItems.length > 0) {
        email += '--- IMPORTANT ITEMS ---\n\n';
        shouldItems.forEach(item => {
          email += num + '. ' + item.flagName + '\n';
          email += '   Current concern: ' + item.whyRisky + '\n';
          if (item.suggestedLanguage) {
            email += '   Proposed revision: ' + item.suggestedLanguage + '\n';
          }
          email += '\n';
          num++;
        });
      }

      if (niceItems.length > 0) {
        email += '--- ADDITIONAL CONSIDERATIONS ---\n\n';
        niceItems.forEach(item => {
          email += num + '. ' + item.flagName + '\n';
          email += '   ' + item.whyRisky + '\n';
          email += '\n';
          num++;
        });
      }

      email += 'I believe these amendments will create a more balanced agreement that works well for both parties. I am happy to discuss these points at your convenience.\n\n';
      email += 'Best regards,\n[Your Name]\n';

      navigator.clipboard.writeText(email).then(() => {
        const btn = event.target;
        const orig = btn.textContent;
        btn.textContent = '‚úÖ Email draft copied!';
        setTimeout(() => btn.textContent = orig, 2500);
      });
    }

    function copyNegotiationBullets() {
      if (!currentAnalysis || !currentAnalysis.negotiationPlaybook) return;
      const pb = currentAnalysis.negotiationPlaybook;

      let text = 'NEGOTIATION POINTS\n';
      text += '==================\n\n';

      const groups = { 'must-negotiate': 'MUST-NEGOTIATE', 'should-negotiate': 'SHOULD-NEGOTIATE', 'nice-to-have': 'NICE-TO-HAVE' };
      for (const [priority, label] of Object.entries(groups)) {
        const items = pb.suggestions.filter(s => s.priority === priority);
        if (items.length === 0) continue;
        text += '## ' + label + '\n\n';
        items.forEach(item => {
          text += '‚Ä¢ ' + item.flagName + '\n';
          text += '  Risk: ' + item.whyRisky + '\n';
          if (item.suggestedLanguage) text += '  Suggested: ' + item.suggestedLanguage + '\n';
          text += '  Tip: ' + item.negotiationTip + '\n\n';
        });
      }

      text += '---\nGenerated by BriefPulse ‚Äî https://delta.abapture.ai\n';

      navigator.clipboard.writeText(text).then(() => {
        const btn = event.target;
        const orig = btn.textContent;
        btn.textContent = '‚úÖ Copied!';
        setTimeout(() => btn.textContent = orig, 2500);
      });
    }

    // ========== START ==========
    init();
  
    // ========== TEMPLATES ==========
    let allTemplates = [];
    let templateCategories = [];
    
    async function loadTemplates() {
      try {
        const res = await fetch('/api/templates');
        const data = await res.json();
        allTemplates = data.templates;
        templateCategories = data.categories;
        
        const sel = document.getElementById('template-category-filter');
        sel.innerHTML = '<option value="">All Categories</option>' + templateCategories.map(c => '<option value="'+c+'">'+c+'</option>').join('');
        
        renderTemplates(allTemplates);
      } catch(e) { console.error('Failed to load templates', e); }
    }
    
    function filterTemplates() {
      const search = document.getElementById('template-search').value.toLowerCase();
      const cat = document.getElementById('template-category-filter').value;
      let filtered = allTemplates;
      if (search) filtered = filtered.filter(t => t.title.toLowerCase().includes(search) || t.description.toLowerCase().includes(search));
      if (cat) filtered = filtered.filter(t => t.category === cat);
      renderTemplates(filtered);
    }
    
    function renderTemplates(templates) {
      const grid = document.getElementById('templates-grid');
      if (!templates.length) { grid.innerHTML = '<p style="color:var(--text-muted);grid-column:1/-1;text-align:center;padding:2rem;">No templates found.</p>'; return; }
      grid.innerHTML = templates.map(t => {
        const riskColors = { low: 'var(--green)', medium: 'var(--orange)', high: 'var(--red)' };
        const riskLabels = { low: 'Low Risk', medium: 'Medium Risk', high: 'High Risk' };
        return '<div style="background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:1.5rem;cursor:pointer;transition:all 0.2s;" onmouseover="this.style.borderColor=\'var(--accent)\';this.style.transform=\'translateY(-2px)\'" onmouseout="this.style.borderColor=\'var(--border)\';this.style.transform=\'none\'" onclick="openTemplate(\''+t.id+'\')">' +
          '<div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:0.75rem;">' +
            '<span style="font-size:0.75rem;padding:0.2rem 0.6rem;border-radius:100px;background:var(--surface2);color:var(--text-muted);">'+t.category+'</span>' +
            '<span style="font-size:0.75rem;padding:0.2rem 0.6rem;border-radius:100px;color:white;background:'+riskColors[t.riskLevel]+';">'+riskLabels[t.riskLevel]+'</span>' +
          '</div>' +
          '<h3 style="font-size:1.05rem;font-weight:700;margin-bottom:0.5rem;">'+t.title+'</h3>' +
          '<p style="color:var(--text-muted);font-size:0.85rem;line-height:1.5;margin-bottom:0.75rem;">'+t.description+'</p>' +
          '<div style="display:flex;gap:1rem;font-size:0.8rem;color:var(--text-dim);">' +
            '<span>üìù '+t.wordCount+' words</span>' +
            '<span>üî§ '+t.placeholderCount+' fields</span>' +
            '<span>‚ö†Ô∏è '+t.commonRedFlags.length+' watch items</span>' +
          '</div>' +
        '</div>';
      }).join('');
    }
    
    async function openTemplate(id) {
      try {
        const res = await fetch('/api/templates/' + id);
        const t = await res.json();
        const riskColors = { low: 'var(--green)', medium: 'var(--orange)', high: 'var(--red)' };
        const riskLabels = { low: 'Low Risk', medium: 'Medium Risk', high: 'High Risk' };
        
        document.getElementById('template-modal-content').innerHTML =
          '<div style="display:flex;gap:0.75rem;align-items:center;margin-bottom:1rem;flex-wrap:wrap;">' +
            '<span style="font-size:0.8rem;padding:0.25rem 0.75rem;border-radius:100px;background:var(--surface2);color:var(--text-muted);">'+t.category+'</span>' +
            '<span style="font-size:0.8rem;padding:0.25rem 0.75rem;border-radius:100px;color:white;background:'+riskColors[t.riskLevel]+';">'+riskLabels[t.riskLevel]+'</span>' +
            '<span style="font-size:0.8rem;color:var(--text-dim);">üìù '+t.wordCount+' words</span>' +
            '<span style="font-size:0.8rem;color:var(--text-dim);">üî§ '+t.placeholders.length+' placeholders</span>' +
          '</div>' +
          '<h2 style="font-size:1.5rem;font-weight:800;margin-bottom:0.75rem;">'+t.title+'</h2>' +
          '<p style="color:var(--text-muted);margin-bottom:1rem;">'+t.description+'</p>' +
          
          (t.commonRedFlags.length ? '<div style="margin-bottom:1.5rem;"><h3 style="font-size:0.9rem;font-weight:700;margin-bottom:0.5rem;color:var(--orange);">‚ö†Ô∏è Common Red Flags to Watch For</h3>' +
            '<div style="display:flex;flex-wrap:wrap;gap:0.5rem;">' + t.commonRedFlags.map(f => '<span style="font-size:0.8rem;padding:0.3rem 0.7rem;background:rgba(245,158,11,0.1);border:1px solid rgba(245,158,11,0.3);border-radius:8px;color:var(--orange);">'+f+'</span>').join('') + '</div></div>' : '') +
          
          '<div style="margin-bottom:1.5rem;">' +
            '<h3 style="font-size:0.9rem;font-weight:700;margin-bottom:0.5rem;">üìã Contract Text</h3>' +
            '<pre style="background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:1.25rem;font-size:0.85rem;line-height:1.6;white-space:pre-wrap;word-wrap:break-word;max-height:400px;overflow-y:auto;color:var(--text);">' + t.text.replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\[([A-Z][A-Z_ ,\/.()]+)\]/g, '<span style="background:rgba(124,92,252,0.2);color:var(--accent);padding:0.1rem 0.3rem;border-radius:4px;">[$1]</span>') + '</pre>' +
          '</div>' +
          
          '<div style="display:flex;gap:0.75rem;flex-wrap:wrap;">' +
            '<button class="btn btn-primary" onclick="analyzeTemplate(\''+t.id+'\')">üîç Analyze This Template</button>' +
            '<button class="btn btn-secondary" onclick="downloadTemplatePDF(\''+t.id+'\')">üì• Download as PDF</button>' +
            '<button class="btn btn-secondary" onclick="copyTemplateText(\''+t.id+'\')">üìã Copy Text</button>' +
            '<button class="btn btn-secondary" onclick="useTemplateInAnalyzer(\''+t.id+'\')">‚úèÔ∏è Edit & Analyze</button>' +
          '</div>';
        
        document.getElementById('template-modal').style.display = 'block';
        document.body.style.overflow = 'hidden';
        window._currentTemplate = t;
      } catch(e) { alert('Failed to load template'); }
    }
    
    function closeTemplateModal() {
      document.getElementById('template-modal').style.display = 'none';
      document.body.style.overflow = '';
    }
    
    async function analyzeTemplate(id) {
      closeTemplateModal();
      showPage('home');
      const heroEl = document.getElementById('hero-section');
      if (heroEl) heroEl.classList.add('hidden');
      
      const btn = document.getElementById('analyze-btn');
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner"></span> Analyzing template...';
      document.getElementById('results-section').classList.add('hidden');
      
      try {
        const res = await fetch('/api/templates/' + id + '/analyze', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', ...(typeof authToken !== 'undefined' && authToken ? { Authorization: 'Bearer ' + authToken } : {}) },
          body: JSON.stringify({ values: {} })
        });
        const data = await res.json();
        if (!res.ok) { alert(data.error || 'Analysis failed'); return; }
        renderResults(data);
      } catch(e) { alert('Analysis failed: ' + e.message); }
      finally { btn.disabled = false; btn.textContent = 'üîç Analyze Contract'; }
    }
    
    function downloadTemplatePDF(id) {
      const t = window._currentTemplate;
      if (!t) return;
      const html = '<!DOCTYPE html><html><head><meta charset="utf-8"><title>'+t.title+' ‚Äî BriefPulse Template</title>' +
        '<style>body{font-family:-apple-system,BlinkMacSystemFont,sans-serif;max-width:800px;margin:0 auto;padding:40px;line-height:1.6;color:#1a1a2e;}' +
        'h1{color:#7c5cfc;border-bottom:3px solid #7c5cfc;padding-bottom:10px;}' +
        '.meta{color:#6b7280;font-size:13px;margin-bottom:20px;}' +
        '.placeholder{background:#f3e8ff;color:#7c5cfc;padding:2px 6px;border-radius:4px;font-weight:600;}' +
        '.flags{margin:20px 0;padding:15px;background:#fffbeb;border-left:4px solid #f59e0b;border-radius:4px;}' +
        '.footer{margin-top:40px;padding-top:20px;border-top:1px solid #e5e7eb;color:#9ca3af;font-size:12px;text-align:center;}' +
        'pre{white-space:pre-wrap;word-wrap:break-word;background:#f9fafb;padding:20px;border-radius:8px;font-size:14px;line-height:1.8;}' +
        '@media print{body{padding:20px;}}</style></head><body>' +
        '<h1>'+t.title+'</h1>' +
        '<p class="meta">Category: '+t.category+' | Risk Level: '+t.riskLevel.toUpperCase()+' | '+t.wordCount+' words | '+t.placeholders.length+' placeholders</p>' +
        '<p>'+t.description+'</p>' +
        (t.commonRedFlags.length ? '<div class="flags"><strong>‚ö†Ô∏è Common Red Flags:</strong><ul>'+t.commonRedFlags.map(f=>'<li>'+f+'</li>').join('')+'</ul></div>' : '') +
        '<h2>Contract Text</h2><pre>'+t.text.replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\[([A-Z][A-Z_ ,\/.()]+)\]/g,'<span class="placeholder">[$1]</span>')+'</pre>' +
        '<div class="footer">Generated by BriefPulse ‚Äî https://delta.abapture.ai<br>This is a template for informational purposes only and does not constitute legal advice.</div>' +
        '</body></html>';
      const blob = new Blob([html], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = t.id + '-template.html';
      a.click();
      URL.revokeObjectURL(url);
    }
    
    function copyTemplateText(id) {
      const t = window._currentTemplate;
      if (!t) return;
      navigator.clipboard.writeText(t.text).then(() => {
        const btn = event.target;
        const orig = btn.textContent;
        btn.textContent = '‚úÖ Copied!';
        setTimeout(() => btn.textContent = orig, 2000);
      });
    }
    
    function useTemplateInAnalyzer(id) {
      const t = window._currentTemplate;
      if (!t) return;
      closeTemplateModal();
      showPage('home');
      document.getElementById('contract-text').value = t.text;
      document.getElementById('contract-text').scrollIntoView({ behavior: 'smooth' });
    }

    </script>
</body>
</html>
